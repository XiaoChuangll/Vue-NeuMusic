import{_ as us,a as vs,b as _s,m as _,c as h}from"./index-h1JUByrL.js";import{r as c,i as ys,w as hs,o as ps,j as gs,a as n,b as a,F as d,f as u,t as i,e as S,d as A,h as o,n as w,u as p}from"./vendor-DY0UzM5c.js";import"./utils-DOv6pLCg.js";const ms={class:"discover-page page-container"},fs={class:"discover-header"},ks={class:"discover-tabs"},bs=["onClick"],ws={key:0,class:"loading-container"},Cs={key:1,class:"error-container"},Ss={class:"error-message"},As={key:2,class:"discover-content"},Ts={key:0,class:"discover-section"},Ps={key:0,class:"banner-section"},$s={class:"banner-container"},Is=["onClick"],Ms=["src","alt"],Us={class:"banner-info"},Ds={class:"banner-dots"},Bs=["onClick"],Ns={class:"playlist-section"},Rs={class:"playlist-grid"},js=["onClick"],Es={class:"card-cover"},Fs=["src","alt"],Ls={class:"play-count"},zs={class:"playlist-info"},Vs={class:"playlist-name"},xs={class:"playlist-desc"},Os={class:"newsong-section"},qs={class:"song-list"},Ks={class:"song-index"},Gs={class:"song-cover"},Hs=["src","alt"],Js={class:"song-info"},Qs={class:"song-name"},Ws={class:"song-artist"},Xs={class:"song-actions"},Ys=["onClick"],Zs=["onClick"],se={key:1,class:"discover-section"},ee={class:"category-tabs"},ae=["onClick"],te={class:"playlist-grid"},ne=["onClick"],oe={class:"card-cover"},le=["src","alt"],ie={class:"play-count"},ce={class:"playlist-info"},re={class:"playlist-name"},de={class:"playlist-creator"},ue={key:0,class:"load-more"},ve=["disabled"],_e={key:0,class:"fas fa-spinner fa-spin"},ye={key:1,class:"fas fa-chevron-down"},he={key:2,class:"discover-section"},pe={class:"rank-grid"},ge=["onClick"],me={class:"rank-cover"},fe=["src","alt"],ke={class:"rank-update"},be={class:"rank-info"},we={class:"rank-songs"},Ce={class:"rank-number"},Se={class:"rank-song-name"},Ae={class:"rank-artist"},Te={key:3,class:"discover-section"},Pe={class:"artist-categories"},$e={class:"category-group"},Ie={class:"category-options"},Me=["onClick"],Ue={class:"category-group"},De={class:"category-options"},Be=["onClick"],Ne={class:"artist-grid"},Re=["onClick"],je={class:"artist-avatar"},Ee=["src","alt"],Fe={class:"artist-info"},Le={key:0},ze={key:0,class:"load-more"},Ve=["disabled"],xe={key:0,class:"fas fa-spinner fa-spin"},Oe={key:1,class:"fas fa-chevron-down"},qe={__name:"Discover",setup(Ke){const j=vs(),v=_s(),I=c(!1),T=c(""),g=c("recommend"),C=c(0),k=c("全部"),r=c(!1),m=c([]),E=c([]),F=c([]),M=c([]),L=c([]),U=c([]),D=c(0),B=c(0),P=c(!0),$=c(!0),f=ys({area:-1,type:-1}),H=[{key:"recommend",name:"个性推荐"},{key:"playlist",name:"歌单"},{key:"rank",name:"排行榜"},{key:"artist",name:"歌手"}],J=[{name:"全部"},{name:"华语"},{name:"欧美"},{name:"日语"},{name:"韩语"},{name:"民谣"},{name:"电子"},{name:"摇滚"}],Q=[{label:"全部",value:-1},{label:"华语",value:7},{label:"欧美",value:96},{label:"日本",value:8},{label:"韩国",value:16},{label:"其他",value:0}],W=[{label:"全部",value:-1},{label:"男歌手",value:1},{label:"女歌手",value:2},{label:"乐队",value:3}],X=async s=>{g.value=s,await N()},N=async()=>{I.value=!0,T.value="";try{switch(g.value){case"recommend":await Y();break;case"playlist":await z();break;case"rank":await Z();break;case"artist":await V();break}}catch(s){console.error("加载数据失败:",s),T.value="加载失败，请稍后重试"}finally{I.value=!1}},Y=async()=>{const[s,t,e]=await Promise.all([_.getBanner().catch(()=>({banners:[]})),_.getPersonalized(12).catch(()=>({result:[]})),_.getPersonalizedNewsong(10).catch(()=>({result:[]}))]);m.value=s.banners||[],E.value=t.result||[],F.value=e.result||[]},z=async()=>{D.value=0;const s=k.value==="全部"?"":k.value,t=await _.getTopPlaylists(s,50,0);M.value=t.playlists||[],P.value=t.more},Z=async()=>{const s=await _.getToplistDetail();L.value=s.list||[]},V=async()=>{B.value=0;const s=await _.getTopArtists({area:f.area,type:f.type,limit:50,offset:0});U.value=s.artists||[],$.value=s.more},ss=async s=>{k.value=s,await z()},x=async(s,t)=>{f[s]=t,await V()},es=async()=>{if(!(r.value||!P.value)){r.value=!0;try{D.value+=50;const s=k.value==="全部"?"":k.value,t=await _.getTopPlaylists(s,50,D.value);M.value.push(...t.playlists||[]),P.value=t.more}catch{v.showError("加载更多歌单失败")}finally{r.value=!1}}},as=async()=>{if(!(r.value||!$.value)){r.value=!0;try{B.value+=50;const s=await _.getTopArtists({area:f.area,type:f.type,limit:50,offset:B.value});U.value.push(...s.artists||[]),$.value=s.more}catch{v.showError("加载更多歌手失败")}finally{r.value=!1}}},R=s=>{var t,e;return s!=null&&s.ar&&Array.isArray(s.ar)?s.ar.map(l=>l.name).join(" / "):s!=null&&s.artists&&Array.isArray(s.artists)?s.artists.map(l=>l.name).join(" / "):(t=s==null?void 0:s.song)!=null&&t.artists&&Array.isArray(s.song.artists)?s.song.artists.map(l=>l.name).join(" / "):(e=s==null?void 0:s.simpleSong)!=null&&e.ar&&Array.isArray(s.simpleSong.ar)?s.simpleSong.ar.map(l=>l.name).join(" / "):"未知歌手"},O=s=>{var t;return s?typeof s.first=="string"?s.first:s.name?s.name:(t=s.simpleSong)!=null&&t.name?s.simpleSong.name:"":""},ts=s=>s?typeof s.second=="string"?s.second:s.simpleSong?R(s.simpleSong):R(s):"",ns=(s,t)=>{var e;return(s==null?void 0:s.id)||((e=s==null?void 0:s.simpleSong)==null?void 0:e.id)||`${t}-${O(s)}`},os=s=>{console.log("点击轮播图:",s)},q=s=>{s!=null&&s.id?v.showPlaylistModal(s.id):v.showModal("playlistModal"),console.log("打开歌单:",s)},ls=s=>{s!=null&&s.id?v.showPlaylistModal(s.id):console.log("打开排行榜:",s)},is=s=>{v.showModal("artistModal"),console.log("打开歌手:",s)},cs=async s=>{try{const t=await _.getSongDetail(s.id);if(t.code===200&&t.songs.length>0){const e=t.songs[0];await j.playSong(e,[e],0),v.showSuccess(`开始播放: ${e.name}`)}}catch{v.showError("播放失败")}},rs=async s=>{try{const t=await _.getSongDetail(s.id);if(t.code===200&&t.songs.length>0){const e=t.songs[0];j.addToPlaylist(e),v.showSuccess(`已添加到播放列表: ${e.name}`)}}catch{v.showError("添加失败")}};let b=null;const ds=()=>{b&&clearInterval(b),b=setInterval(()=>{m.value.length>1&&(C.value=(C.value+1)%m.value.length)},5e3)},K=()=>{b&&(clearInterval(b),b=null)};return hs(m,s=>{s.length>1?ds():K()},{immediate:!0}),ps(()=>{N()}),gs(()=>{K()}),(s,t)=>(o(),n("div",ms,[a("div",fs,[t[0]||(t[0]=a("h1",null,"发现音乐",-1)),a("div",ks,[(o(),n(d,null,u(H,e=>a("span",{key:e.key,class:w(["discover-tab",{active:g.value===e.key}]),onClick:l=>X(e.key)},i(e.name),11,bs)),64))])]),I.value?(o(),n("div",ws,[...t[1]||(t[1]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"加载中...",-1)])])):T.value?(o(),n("div",Cs,[a("div",Ss,i(T.value),1),a("button",{class:"error-retry neu-button",onClick:N},[...t[2]||(t[2]=[a("i",{class:"fas fa-redo"},null,-1),S(" 重试 ",-1)])])])):(o(),n("div",As,[g.value==="recommend"?(o(),n("div",Ts,[m.value.length>0?(o(),n("div",Ps,[t[3]||(t[3]=a("h2",{class:"section-title"},"精选推荐",-1)),a("div",$s,[(o(!0),n(d,null,u(m.value,(e,l)=>(o(),n("div",{key:e.bannerId,class:w(["banner-item neu-card",{active:C.value===l}]),onClick:y=>os(e)},[a("img",{src:p(h).getImageUrl(e.pic,600),alt:e.typeTitle},null,8,Ms),a("div",Us,[a("h3",null,i(e.typeTitle),1)])],10,Is))),128))]),a("div",Ds,[(o(!0),n(d,null,u(m.value,(e,l)=>(o(),n("span",{key:l,class:w(["dot",{active:C.value===l}]),onClick:y=>C.value=l},null,10,Bs))),128))])])):A("",!0),a("div",Ns,[t[6]||(t[6]=a("h2",{class:"section-title"},"推荐歌单",-1)),a("div",Rs,[(o(!0),n(d,null,u(E.value,e=>(o(),n("div",{key:e.id,class:"playlist-card neu-card",onClick:l=>q(e)},[a("div",Es,[a("img",{src:p(h).getImageUrl(e.picUrl,300),alt:e.name},null,8,Fs),t[5]||(t[5]=a("div",{class:"card-play-icon"},[a("i",{class:"fas fa-play-circle"})],-1)),a("div",Ls,[t[4]||(t[4]=a("i",{class:"fas fa-headphones"},null,-1)),S(" "+i(p(h).formatPlayCount(e.playCount)),1)])]),a("div",zs,[a("h3",Vs,i(e.name),1),a("p",xs,i(e.copywriter||"精选歌单"),1)])],8,js))),128))])]),a("div",Os,[t[9]||(t[9]=a("h2",{class:"section-title"},"新歌速递",-1)),a("div",qs,[(o(!0),n(d,null,u(F.value,(e,l)=>(o(),n("div",{key:e.id,class:"song-item neu-card"},[a("div",Ks,i(l+1),1),a("div",Gs,[a("img",{src:p(h).getImageUrl(e.picUrl,100),alt:e.name},null,8,Hs)]),a("div",Js,[a("h4",Qs,i(e.name),1),a("p",Ws,i(R(e.song)),1)]),a("div",Xs,[a("button",{class:"action-btn",onClick:y=>cs(e),title:"播放"},[...t[7]||(t[7]=[a("i",{class:"fas fa-play"},null,-1)])],8,Ys),a("button",{class:"action-btn",onClick:y=>rs(e),title:"添加到播放列表"},[...t[8]||(t[8]=[a("i",{class:"fas fa-plus"},null,-1)])],8,Zs)])]))),128))])])])):g.value==="playlist"?(o(),n("div",se,[a("div",ee,[(o(),n(d,null,u(J,e=>a("span",{key:e.name,class:w(["category-tab neu-button",{active:k.value===e.name}]),onClick:l=>ss(e.name)},i(e.name),11,ae)),64))]),a("div",te,[(o(!0),n(d,null,u(M.value,e=>{var l;return o(),n("div",{key:e.id,class:"playlist-card neu-card",onClick:y=>q(e)},[a("div",oe,[a("img",{src:p(h).getImageUrl(e.coverImgUrl,300),alt:e.name},null,8,le),t[11]||(t[11]=a("div",{class:"card-play-icon"},[a("i",{class:"fas fa-play-circle"})],-1)),a("div",ie,[t[10]||(t[10]=a("i",{class:"fas fa-headphones"},null,-1)),S(" "+i(p(h).formatPlayCount(e.playCount)),1)])]),a("div",ce,[a("h3",re,i(e.name),1),a("p",de,"by "+i((l=e.creator)==null?void 0:l.nickname),1)])],8,ne)}),128))]),P.value?(o(),n("div",ue,[a("button",{class:"neu-button",onClick:es,disabled:r.value},[r.value?(o(),n("i",_e)):(o(),n("i",ye)),S(" "+i(r.value?"加载中...":"加载更多"),1)],8,ve)])):A("",!0)])):g.value==="rank"?(o(),n("div",he,[a("div",pe,[(o(!0),n(d,null,u(L.value,e=>{var l;return o(),n("div",{key:e.id,class:"rank-card neu-card",onClick:y=>ls(e)},[a("div",me,[a("img",{src:p(h).getImageUrl(e.coverImgUrl,300),alt:e.name},null,8,fe),a("div",ke,i(e.updateFrequency),1)]),a("div",be,[a("h3",null,i(e.name),1),a("div",we,[(o(!0),n(d,null,u((l=e.tracks)==null?void 0:l.slice(0,3),(y,G)=>(o(),n("div",{key:ns(y,G),class:"rank-song"},[a("span",Ce,i(G+1),1),a("span",Se,i(O(y)),1),a("span",Ae,i(ts(y)),1)]))),128))])])],8,ge)}),128))])])):g.value==="artist"?(o(),n("div",Te,[a("div",Pe,[a("div",$e,[t[12]||(t[12]=a("h3",null,"语种",-1)),a("div",Ie,[(o(),n(d,null,u(Q,e=>a("span",{key:e.value,class:w(["category-option neu-button",{active:f.area===e.value}]),onClick:l=>x("area",e.value)},i(e.label),11,Me)),64))])]),a("div",Ue,[t[13]||(t[13]=a("h3",null,"分类",-1)),a("div",De,[(o(),n(d,null,u(W,e=>a("span",{key:e.value,class:w(["category-option neu-button",{active:f.type===e.value}]),onClick:l=>x("type",e.value)},i(e.label),11,Be)),64))])])]),a("div",Ne,[(o(!0),n(d,null,u(U.value,e=>(o(),n("div",{key:e.id,class:"artist-card neu-card",onClick:l=>is(e)},[a("div",je,[a("img",{src:p(h).getImageUrl(e.img1v1Url,200),alt:e.name},null,8,Ee)]),a("div",Fe,[a("h3",null,i(e.name),1),e.alias&&e.alias.length>0?(o(),n("p",Le,i(e.alias[0]),1)):A("",!0)])],8,Re))),128))]),$.value?(o(),n("div",ze,[a("button",{class:"neu-button",onClick:as,disabled:r.value},[r.value?(o(),n("i",xe)):(o(),n("i",Oe)),S(" "+i(r.value?"加载中...":"加载更多"),1)],8,Ve)])):A("",!0)])):A("",!0)]))]))}},Qe=us(qe,[["__scopeId","data-v-c26ac1f6"]]);export{Qe as default};
