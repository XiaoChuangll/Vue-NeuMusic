import{c as n,r as m,w as B,o as ls,a as r,b as s,s as ns,x as as,e as is,y as rs,d as cs,n as d,u as x,t as f,A as U,l as us,v as ds,F as vs,f as ps,h as c}from"./vendor-DY0UzM5c.js";import{_ as ms,a as fs,u as gs,b as ys,c as L,m as F}from"./index-h1JUByrL.js";import"./utils-DOv6pLCg.js";const _s={class:"now-playing-page page-container"},ks={key:0,class:"no-song"},hs={key:1,class:"playing-content"},bs={class:"song-display"},ws={class:"album-cover-container"},Ss=["src","alt"],Cs={class:"song-info"},xs={class:"song-title"},Ls={class:"song-artist"},Is={class:"song-album"},Ts={class:"player-controls"},Ms=["title"],Vs={class:"progress-section"},Ns={class:"time current-time"},Ps={class:"progress-track"},Es={class:"time total-time"},As={class:"additional-controls"},Bs=["title"],Us={class:"volume-control"},Fs=["title"],Xs={class:"volume-slider"},zs={key:0,class:"lyrics-section"},Ds={class:"lyrics-container"},js={key:0,class:"lyrics-loading"},Os={key:1,class:"no-lyrics"},Rs=["onClick"],$s={__name:"NowPlaying",setup(qs){const o=fs(),k=gs(),h=ys(),l=n(()=>o.currentSong),g=n(()=>o.isPlaying),I=n(()=>o.currentTime),b=n(()=>o.duration);n(()=>o.currentIndex),n(()=>o.playlist);const S=n(()=>o.loopMode),X=n(()=>o.isShuffled),T=n(()=>o.volume),M=n(()=>o.isMuted),z=m(!0),v=m(50),y=m([]),w=m(-1),C=m(!1),D=m(null),V=n(()=>b.value>0?I.value/b.value*100:0),j=n(()=>({order:"顺序播放",loop:"列表循环",single:"单曲循环"})[S.value]||"顺序播放"),O=n(()=>({order:"fas fa-arrow-right",loop:"fas fa-redo",single:"fas fa-redo-alt"})[S.value]||"fas fa-arrow-right"),R=n(()=>M.value||v.value===0?"fas fa-volume-mute":v.value<50?"fas fa-volume-down":"fas fa-volume-up"),$=()=>{g.value?o.pause():o.play()},q=()=>{o.previous()},G=()=>{o.next()},H=t=>{const e=t.currentTarget.getBoundingClientRect(),u=(t.clientX-e.left)/e.width,i=b.value*u;o.seek(i)},J=()=>{const t=["order","loop","single"],a=(t.indexOf(S.value)+1)%t.length;o.setLoopMode(t[a])},K=()=>{o.toggleShuffle()},Q=()=>{o.setVolume(v.value/100)},W=()=>{o.toggleMute()},Y=async()=>{if(!k.isLoggedIn){h.showError("请先登录");return}try{const t=N(l.value.id);await F.likeSong(l.value.id,!t),t?k.removeFromLikedSongs(l.value.id):k.addToLikedSongs(l.value),h.showSuccess(t?"已取消喜欢":"已添加到我喜欢的音乐")}catch{h.showError("操作失败")}},Z=()=>{h.showInfo("下载功能开发中")},N=t=>k.likedSongs.some(e=>e.id===t),ss=t=>t.ar?t.ar.map(e=>e.name).join(", "):"未知艺人",P=async t=>{var e;if(t){C.value=!0,y.value=[],w.value=-1;try{const a=await F.getLyric(t);a.code===200&&((e=a.lrc)!=null&&e.lyric)&&es(a.lrc.lyric)}catch(a){console.error("加载歌词失败:",a)}finally{C.value=!1}}},es=t=>{const e=t.split(`
`),a=[];e.forEach(u=>{const i=u.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);if(i){const p=parseInt(i[1]),_=parseInt(i[2]),E=parseInt(i[3].padEnd(3,"0")),os=p*60+_+E/1e3,A=i[4].trim();A&&a.push({time:os,text:A})}}),y.value=a.sort((u,i)=>u.time-i.time)},ts=t=>{o.seek(t)};return B(l,t=>{t?P(t.id):(y.value=[],w.value=-1)}),B(T,t=>{v.value=t*100}),ls(()=>{v.value=T.value*100,l.value&&P(l.value.id)}),(t,e)=>{var u,i;const a=rs("router-link");return c(),r("div",_s,[l.value?(c(),r("div",hs,[s("div",bs,[s("div",ws,[s("div",{class:d(["album-cover",{spinning:g.value}])},[s("img",{src:x(L).getImageUrl((u=l.value.al)==null?void 0:u.picUrl,500),alt:l.value.name},null,8,Ss),e[5]||(e[5]=s("div",{class:"vinyl-center"},null,-1))],2),s("div",{class:d(["needle",{playing:g.value}])},null,2)]),s("div",Cs,[s("h1",xs,f(l.value.name),1),s("p",Ls,f(ss(l.value)),1),s("p",Is,f((i=l.value.al)==null?void 0:i.name),1),s("div",Ts,[s("button",{class:"control-btn",onClick:q,title:"上一首"},[...e[6]||(e[6]=[s("i",{class:"fas fa-step-backward"},null,-1)])]),s("button",{class:"control-btn play-btn",onClick:$,title:g.value?"暂停":"播放"},[s("i",{class:d(g.value?"fas fa-pause":"fas fa-play")},null,2)],8,Ms),s("button",{class:"control-btn",onClick:G,title:"下一首"},[...e[7]||(e[7]=[s("i",{class:"fas fa-step-forward"},null,-1)])])]),s("div",Vs,[s("span",Ns,f(x(L).formatTime(I.value)),1),s("div",{class:"progress-bar",onClick:H},[s("div",Ps,[s("div",{class:"progress-fill",style:U({width:V.value+"%"})},null,4),s("div",{class:"progress-thumb",style:U({left:V.value+"%"})},null,4)])]),s("span",Es,f(x(L).formatTime(b.value)),1)]),s("div",As,[s("button",{class:"control-btn small",onClick:J,title:j.value},[s("i",{class:d(O.value)},null,2)],8,Bs),s("button",{class:d(["control-btn small",{active:X.value}]),onClick:K,title:"随机播放"},[...e[8]||(e[8]=[s("i",{class:"fas fa-random"},null,-1)])],2),s("div",Us,[s("button",{class:"control-btn small",onClick:W,title:M.value?"取消静音":"静音"},[s("i",{class:d(R.value)},null,2)],8,Fs),s("div",Xs,[us(s("input",{type:"range",min:"0",max:"100","onUpdate:modelValue":e[0]||(e[0]=p=>v.value=p),onInput:Q,class:"volume-input"},null,544),[[ds,v.value]])])]),s("button",{class:d(["control-btn small",{liked:N(l.value.id)}]),onClick:Y,title:"喜欢"},[...e[9]||(e[9]=[s("i",{class:"fas fa-heart"},null,-1)])],2),s("button",{class:"control-btn small",onClick:Z,title:"下载"},[...e[10]||(e[10]=[s("i",{class:"fas fa-download"},null,-1)])])])])]),z.value?(c(),r("div",zs,[s("div",Ds,[C.value?(c(),r("div",js,[...e[11]||(e[11]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"加载歌词中...",-1)])])):y.value.length===0?(c(),r("div",Os,[...e[12]||(e[12]=[s("i",{class:"fas fa-music"},null,-1),s("p",null,"暂无歌词",-1)])])):(c(),r("div",{key:2,class:"lyrics-list",ref_key:"lyricsContainer",ref:D},[(c(!0),r(vs,null,ps(y.value,(p,_)=>(c(),r("div",{key:_,class:d(["lyrics-line",{active:_===w.value,past:_<w.value}]),onClick:E=>ts(p.time)},f(p.text),11,Rs))),128))],512))])])):cs("",!0)])):(c(),r("div",ks,[e[2]||(e[2]=s("div",{class:"no-song-icon"},[s("i",{class:"fas fa-music"})],-1)),e[3]||(e[3]=s("h3",null,"暂无播放内容",-1)),e[4]||(e[4]=s("p",null,"选择一首歌曲开始播放",-1)),ns(a,{to:"/discover",class:"neu-button"},{default:as(()=>[...e[1]||(e[1]=[s("i",{class:"fas fa-compass"},null,-1),is(" 发现音乐 ",-1)])]),_:1})]))])}}},Ks=ms($s,[["__scopeId","data-v-3329ecc7"]]);export{Ks as default};
