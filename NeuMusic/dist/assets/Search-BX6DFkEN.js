import{r as v,i as V,c as ds,w as hs,o as vs,k as ys,a as l,b as t,d as f,l as _s,v as fs,m as ps,F as k,f as m,e as g,t as r,p as ks,h as o,n as P,u as $,q as ms}from"./vendor-DY0UzM5c.js";import{_ as gs,a as bs,u as Cs,b as Ss,c as b,m as S}from"./index-h1JUByrL.js";import"./utils-DOv6pLCg.js";const ws={class:"search-page page-container"},Us={class:"search-header"},Is={class:"search-box-large"},$s={key:0,class:"search-tabs"},xs=["onClick"],Hs={key:0,class:"search-count"},Ms={class:"search-content"},As={key:0,class:"search-suggestions"},Ds={key:0,class:"hot-searches"},Ts={class:"hot-search-tags"},Es=["onClick"],Ls={key:1,class:"search-history"},Ns={class:"history-tags"},Ps=["onClick"],Os=["onClick"],Rs={key:1,class:"search-results"},qs={key:0,class:"loading-container"},Ks={key:1,class:"error-container"},Ws={class:"error-message"},Bs={key:2,class:"results-content"},Fs={key:0,class:"songs-results"},Vs={key:0,class:"no-results"},Js={key:1,class:"song-list"},js=["onDblclick"],zs={class:"song-index"},Ys={class:"song-cover"},Gs=["src","alt"],Qs={class:"song-overlay"},Xs=["onClick"],Zs={class:"song-info"},se={class:"song-name"},ee={class:"song-artist"},te={class:"song-album"},ae={class:"song-actions"},le=["onClick"],oe=["onClick"],ne=["onClick"],ie={key:1,class:"artists-results"},re={key:0,class:"no-results"},ce={key:1,class:"artist-grid"},ue=["onClick"],de={class:"artist-avatar"},he=["src","alt"],ve={class:"artist-info"},ye={key:0},_e={key:2,class:"albums-results"},fe={key:0,class:"no-results"},pe={key:1,class:"album-grid"},ke=["onClick"],me={class:"album-cover"},ge=["src","alt"],be={class:"album-info"},Ce={class:"album-date"},Se={key:3,class:"playlists-results"},we={key:0,class:"no-results"},Ue={key:1,class:"playlist-grid"},Ie=["onClick"],$e={class:"playlist-cover"},xe=["src","alt"],He={class:"play-count"},Me={class:"playlist-info"},Ae={class:"track-count"},De={key:4,class:"load-more"},Te=["disabled"],Ee={key:0,class:"fas fa-spinner fa-spin"},Le={key:1,class:"fas fa-chevron-down"},Ne={key:2,class:"search-placeholder"},Pe={__name:"Search",setup(Oe){const O=ys(),J=ks(),M=bs(),w=Cs(),h=Ss(),u=v(""),d=v(1),A=v(!1),C=v(!1),U=v(""),D=v(!1),x=v(!1),T=v(0),c=V({songs:[],artists:[],albums:[],playlists:[]}),E=V({1:0,100:0,10:0,1e3:0}),L=v([]),y=v(JSON.parse(localStorage.getItem("searchHistory")||"[]")),j=[{type:1,name:"单曲"},{type:100,name:"歌手"},{type:10,name:"专辑"},{type:1e3,name:"歌单"}],H=ds(()=>({1:"songs",100:"artists",10:"albums",1e3:"playlists"})[d.value]),z=b.debounce(s=>{s.trim()&&p()},300),p=async()=>{const s=u.value.trim();if(s){A.value=!0,U.value="",T.value=0,D.value=!0,Z(s);try{const e=await S.search(s,d.value,30,0);if(e.code===200){const n=H.value;c[n]=e.result[n]||[],d.value===1&&c.songs.length>0&&await K(c.songs),e.result[n+"Count"]&&(E[d.value]=e.result[n+"Count"]),x.value=c[n].length>=30}else throw new Error(e.message||"搜索失败")}catch(e){console.error("搜索失败:",e),U.value=e.message||"搜索失败，请稍后重试"}finally{A.value=!1}}},Y=async()=>{if(!(C.value||!x.value)){C.value=!0;try{T.value+=30;const s=await S.search(u.value,d.value,30,T.value);if(s.code===200){const e=H.value,n=s.result[e]||[];c[e].push(...n),d.value===1&&n.length>0&&await K(c.songs),x.value=n.length>=30}}catch{h.showError("加载更多失败")}finally{C.value=!1}}},G=async s=>{if(d.value===s)return;d.value=s;const e=H.value;c[e].length===0&&u.value&&await p()},Q=()=>{z(u.value)},X=()=>{u.value="",U.value="",D.value=!1,Object.keys(c).forEach(s=>{c[s]=[]})},R=s=>{u.value=s,p()},Z=s=>{const e=y.value,n=e.indexOf(s);n>-1&&e.splice(n,1),e.unshift(s),e.length>10&&e.pop(),y.value=e,localStorage.setItem("searchHistory",JSON.stringify(e))},ss=s=>{const e=y.value.indexOf(s);e>-1&&(y.value.splice(e,1),localStorage.setItem("searchHistory",JSON.stringify(y.value)))},es=()=>{y.value=[],localStorage.removeItem("searchHistory")},q=s=>!(s!=null&&s.artists)&&!(s!=null&&s.artist)?"未知歌手":(s.artists||(s.artist?[s.artist]:[])).map(n=>n.name).join(" / "),ts=s=>{var e,n;return((e=s==null?void 0:s.album)==null?void 0:e.name)||((n=s==null?void 0:s.al)==null?void 0:n.name)||"未知专辑"},as=(s,e=100)=>{var a,i;const n=((a=s==null?void 0:s.album)==null?void 0:a.picUrl)||((i=s==null?void 0:s.al)==null?void 0:i.picUrl)||(s==null?void 0:s.picUrl);return b.getImageUrl(n,e)},K=async s=>{try{const e=s.map(a=>a.id).filter(Boolean);if(e.length===0)return;const n=await S.getSongDetail(e);if(n.code===200&&Array.isArray(n.songs)){const a=new Map(n.songs.map(i=>[i.id,i]));s.forEach((i,_)=>{var B,F;const I=a.get(i.id);I&&(s[_]={...i,al:I.al||i.al,album:i.album||{name:(B=I.al)==null?void 0:B.name,picUrl:(F=I.al)==null?void 0:F.picUrl},dt:I.dt??i.dt})})}}catch{}},ls=s=>s?new Date(s).getFullYear()+"年":"",W=s=>w.isLiked(s),N=async s=>{try{await M.playSong(s,[s],0),h.showSuccess(`开始播放: ${s.name}`)}catch{h.showError("播放失败")}},os=s=>{M.addToPlaylist(s),h.showSuccess(`已添加到播放列表: ${s.name}`)},ns=async s=>{if(!w.isLoggedIn){h.showError("请先登录");return}try{const e=W(s.id);if(await S.likeSong(s.id,!e),e){const n=w.likeList.indexOf(s.id);n>-1&&w.likeList.splice(n,1)}else w.likeList.push(s.id);h.showSuccess(e?"已取消喜欢":"已添加到我喜欢的音乐")}catch{h.showError("操作失败")}},is=s=>{h.showArtistModal(s.id)},rs=async s=>{try{const e=await S.getAlbumDetail(s.id);if(e.code===200){const n=e.songs||[];n.length>0?(M.setPlaylist(n,0),h.showSuccess("已加载专辑，前往正在播放查看"),J.push({name:"NowPlaying"})):h.showInfo("该专辑暂无可播放歌曲")}}catch{h.showError("打开专辑失败")}},cs=s=>{h.showPlaylistModal(s.id)},us=async()=>{try{const s=await S.getSearchHot();s.code===200&&(L.value=s.result.hots||[])}catch(s){console.error("加载热门搜索失败:",s)}};return hs(()=>O.query.q,s=>{s&&s!==u.value&&(u.value=s,p())},{immediate:!0}),vs(()=>{us();const s=O.query.q;s&&(u.value=s,p())}),(s,e)=>{var n;return o(),l("div",ws,[t("div",Us,[t("div",Is,[e[2]||(e[2]=t("i",{class:"fas fa-search search-icon"},null,-1)),_s(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),onKeyup:ps(p,["enter"]),onInput:Q,class:"search-input-large",placeholder:"搜索音乐、歌手、专辑、歌单"},null,544),[[fs,u.value]]),u.value?(o(),l("button",{key:0,class:"clear-btn",onClick:X},[...e[1]||(e[1]=[t("i",{class:"fas fa-times"},null,-1)])])):f("",!0)]),u.value?(o(),l("div",$s,[(o(),l(k,null,m(j,a=>t("span",{key:a.type,class:P(["search-tab",{active:d.value===a.type}]),onClick:i=>G(a.type)},[g(r(a.name)+" ",1),E[a.type]?(o(),l("span",Hs," ("+r($(b).formatPlayCount(E[a.type]))+") ",1)):f("",!0)],10,xs)),64))])):f("",!0)]),t("div",Ms,[!u.value&&!D.value?(o(),l("div",As,[L.value.length>0?(o(),l("div",Ds,[e[3]||(e[3]=t("h3",null,"热门搜索",-1)),t("div",Ts,[(o(!0),l(k,null,m(L.value,(a,i)=>(o(),l("span",{key:a.searchWord,class:"hot-tag neu-button",onClick:_=>R(a.searchWord)},[t("span",{class:P(["hot-rank",{top:i<3}])},r(i+1),3),g(" "+r(a.searchWord),1)],8,Es))),128))])])):f("",!0),y.value.length>0?(o(),l("div",Ls,[t("div",{class:"history-header"},[e[5]||(e[5]=t("h3",null,"搜索历史",-1)),t("button",{class:"clear-history-btn",onClick:es},[...e[4]||(e[4]=[t("i",{class:"fas fa-trash"},null,-1),g(" 清空 ",-1)])])]),t("div",Ns,[(o(!0),l(k,null,m(y.value,a=>(o(),l("span",{key:a,class:"history-tag neu-button",onClick:i=>R(a)},[g(r(a)+" ",1),t("i",{class:"fas fa-times remove-history",onClick:ms(i=>ss(a),["stop"])},null,8,Os)],8,Ps))),128))])])):f("",!0)])):u.value?(o(),l("div",Rs,[A.value?(o(),l("div",qs,[...e[6]||(e[6]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"搜索中...",-1)])])):U.value?(o(),l("div",Ks,[t("div",Ws,r(U.value),1),t("button",{class:"error-retry neu-button",onClick:p},[...e[7]||(e[7]=[t("i",{class:"fas fa-redo"},null,-1),g(" 重试 ",-1)])])])):(o(),l("div",Bs,[d.value===1?(o(),l("div",Fs,[c.songs.length===0?(o(),l("div",Vs,[...e[8]||(e[8]=[t("i",{class:"fas fa-music"},null,-1),t("p",null,"没有找到相关歌曲",-1)])])):(o(),l("div",Js,[(o(!0),l(k,null,m(c.songs,(a,i)=>(o(),l("div",{key:a.id,class:"song-item neu-card",onDblclick:_=>N(a)},[t("div",zs,r(i+1),1),t("div",Ys,[t("img",{src:as(a,100),alt:a.name},null,8,Gs),t("div",Qs,[t("i",{class:"fas fa-play",onClick:_=>N(a)},null,8,Xs)])]),t("div",Zs,[t("h4",se,r(a.name),1),t("p",ee,r(q(a)),1),t("p",te,r(ts(a)),1)]),t("div",ae,[t("button",{class:"action-btn",onClick:_=>N(a),title:"播放"},[...e[9]||(e[9]=[t("i",{class:"fas fa-play"},null,-1)])],8,le),t("button",{class:"action-btn",onClick:_=>os(a),title:"添加到播放列表"},[...e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1)])],8,oe),t("button",{class:"action-btn",onClick:_=>ns(a),title:"收藏"},[t("i",{class:P(["fas fa-heart",{liked:W(a.id)}])},null,2)],8,ne)])],40,js))),128))]))])):d.value===100?(o(),l("div",ie,[c.artists.length===0?(o(),l("div",re,[...e[11]||(e[11]=[t("i",{class:"fas fa-user-music"},null,-1),t("p",null,"没有找到相关歌手",-1)])])):(o(),l("div",ce,[(o(!0),l(k,null,m(c.artists,a=>(o(),l("div",{key:a.id,class:"artist-card neu-card",onClick:i=>is(a)},[t("div",de,[t("img",{src:$(b).getImageUrl(a.img1v1Url,200),alt:a.name},null,8,he)]),t("div",ve,[t("h3",null,r(a.name),1),a.alias&&a.alias.length>0?(o(),l("p",ye,r(a.alias[0]),1)):f("",!0)])],8,ue))),128))]))])):d.value===10?(o(),l("div",_e,[c.albums.length===0?(o(),l("div",fe,[...e[12]||(e[12]=[t("i",{class:"fas fa-compact-disc"},null,-1),t("p",null,"没有找到相关专辑",-1)])])):(o(),l("div",pe,[(o(!0),l(k,null,m(c.albums,a=>(o(),l("div",{key:a.id,class:"album-card neu-card",onClick:i=>rs(a)},[t("div",me,[t("img",{src:$(b).getImageUrl(a.picUrl,200),alt:a.name},null,8,ge),e[13]||(e[13]=t("div",{class:"album-overlay"},[t("i",{class:"fas fa-play-circle"})],-1))]),t("div",be,[t("h3",null,r(a.name),1),t("p",null,r(q(a)),1),t("p",Ce,r(ls(a.publishTime)),1)])],8,ke))),128))]))])):d.value===1e3?(o(),l("div",Se,[c.playlists.length===0?(o(),l("div",we,[...e[14]||(e[14]=[t("i",{class:"fas fa-list-music"},null,-1),t("p",null,"没有找到相关歌单",-1)])])):(o(),l("div",Ue,[(o(!0),l(k,null,m(c.playlists,a=>{var i;return o(),l("div",{key:a.id,class:"playlist-card neu-card",onClick:_=>cs(a)},[t("div",$e,[t("img",{src:$(b).getImageUrl(a.coverImgUrl,200),alt:a.name},null,8,xe),e[16]||(e[16]=t("div",{class:"playlist-overlay"},[t("i",{class:"fas fa-play-circle"})],-1)),t("div",He,[e[15]||(e[15]=t("i",{class:"fas fa-headphones"},null,-1)),g(" "+r($(b).formatPlayCount(a.playCount)),1)])]),t("div",Me,[t("h3",null,r(a.name),1),t("p",null,"by "+r((i=a.creator)==null?void 0:i.nickname),1),t("p",Ae,r(a.trackCount)+" 首歌曲",1)])],8,Ie)}),128))]))])):f("",!0),x.value&&((n=c[H.value])==null?void 0:n.length)>0?(o(),l("div",De,[t("button",{class:"neu-button",onClick:Y,disabled:C.value},[C.value?(o(),l("i",Ee)):(o(),l("i",Le)),g(" "+r(C.value?"加载中...":"加载更多"),1)],8,Te)])):f("",!0)]))])):(o(),l("div",Ne,[...e[17]||(e[17]=[t("i",{class:"fas fa-search"},null,-1),t("h3",null,"发现你喜欢的音乐",-1),t("p",null,"搜索歌曲、歌手、专辑和歌单",-1)])]))])])}}},We=gs(Pe,[["__scopeId","data-v-7e776ff2"]]);export{We as default};
