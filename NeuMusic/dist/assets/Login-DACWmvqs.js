import{r as n,c as H,o as cs,p as vs,j as fs,a as l,b as e,d as y,s as ps,x as ms,e as i,y as bs,n as c,l as N,v as X,z as Y,m as Z,t as m,u as R,g as ss,A as gs,h as t}from"./vendor-DY0UzM5c.js";import{_ as ys,u as ks,b as ws}from"./index-h1JUByrL.js";import{C as es}from"./utils-DOv6pLCg.js";const _s={class:"login-page"},qs={class:"login-container"},hs={class:"guest-tip"},xs={class:"tip-content"},Cs={class:"login-methods"},Ss={class:"method-tabs"},Ls={key:0,class:"official-login"},Ms={class:"official-container"},Ps={class:"embedded-login"},Qs={class:"embedded-tabs"},$s={key:0,class:"embedded-form"},Is={class:"embedded-input neu-inset"},Ts=["placeholder","disabled"],Es={class:"embedded-input neu-inset"},As=["type","disabled"],Vs=["disabled"],Bs=["disabled"],Ds={key:0,class:"fas fa-spinner fa-spin"},Ns={key:1,class:"fas fa-sign-in-alt"},Rs={key:1,class:"embedded-qr"},Us={class:"qr-mode-selector"},Ws={class:"embedded-qr-container"},Fs=["src"],zs={key:1,class:"embedded-qr-expired"},Ks={key:2,class:"embedded-qr-loading"},Os={class:"embedded-qr-status"},js={key:0,class:"status-waiting"},Js={key:1,class:"status-scanned"},Gs={key:2,class:"status-expired"},Hs={key:0,class:"internal-qr-info"},Xs={class:"embedded-qr-actions"},Ys={key:2,class:"embedded-web"},Zs={class:"web-sync-container"},se={class:"web-sync-actions"},ee=["disabled"],ae={key:0,class:"fas fa-spinner fa-spin"},le={key:1,class:"fas fa-sync-alt"},te=["disabled"],ie={key:0,class:"fas fa-spinner fa-spin"},ne={key:1,class:"fas fa-magic"},oe={key:1,class:"web-sync-progress"},ue={class:"progress-info"},de={class:"progress-bar"},re={class:"progress-text"},ce={key:1,class:"account-login"},ve={class:"login-box neu-inset"},fe={key:0,class:"fas fa-envelope"},pe={key:1,class:"fas fa-mobile-alt"},me=["placeholder","disabled"],be={class:"login-box neu-inset"},ge=["type","disabled"],ye=["disabled"],ke={class:"login-buttons"},we=["disabled"],_e={key:0,class:"fas fa-spinner fa-spin"},qe={key:1,class:"fas fa-check"},he={class:"account-switch"},xe={key:2,class:"qr-login"},Ce={class:"qr-container"},Se=["src"],Le={key:1,class:"qr-expired"},Me={key:2,class:"qr-loading"},Pe={class:"qr-status"},Qe={key:0,class:"status-waiting"},$e={key:1,class:"status-scanned"},Ie={key:2,class:"status-expired"},Te={class:"qr-actions"},Ee={key:3,class:"error-message"},Ae={key:4,class:"success-message"},Ve={__name:"Login",setup(Be){const _=vs(),u=ks();ws();const w=n("official"),M=n("phone"),P=n(""),E=n(""),A=n(!1),q=n(!1),f=n(""),h=n(""),k=n("waiting"),Q=n(!1),r=n(""),b=n("info"),$=n(!1),p=n(null);n("embedded");const v=n("phone"),I=n(""),V=n(""),B=n(!1),x=n(!1),g=n("waiting"),C=n("official"),as=n(null);let S=null,L=null;const K=H(()=>P.value.trim()&&E.value.trim()),O=H(()=>I.value.trim()&&V.value.trim()),U=a=>{w.value=a,ls(),a==="qr"&&W()},D=a=>{v.value=a,T(),a==="qr"&&F()},j=a=>{C.value=a,T(),v.value==="qr"&&(a==="official"?F():z())},ls=()=>{f.value="",h.value="",r.value=""},T=()=>{f.value="",h.value=""},J=async()=>{if(O.value){x.value=!0,T();try{const a=v.value==="phone",s=es.MD5(V.value).toString();let d;a?d=await u.loginByPhone(I.value,s):d=await u.loginByEmail(I.value,s),d.success?(h.value=d.message,setTimeout(()=>{_.push("/")},1500)):f.value=d.message}catch(a){console.error("站内登录失败:",a),f.value="登录失败，请重试"}finally{x.value=!1}}},G=async()=>{if(K.value){q.value=!0,f.value="";try{const a=M.value==="phone",s=es.MD5(E.value).toString();let d;a?d=await u.loginByPhone(P.value,s):d=await u.loginByEmail(P.value,s),d.success?(h.value=d.message,setTimeout(()=>{_.push("/")},1500)):f.value=d.message}catch(a){console.error("登录失败:",a),f.value="登录失败，请重试"}finally{q.value=!1}}},W=async()=>{(await u.getQrCode()).success&&(k.value="waiting",ts())},F=async()=>{C.value==="official"?(await u.getQrCode()).success&&(g.value="waiting",is()):z()},z=async()=>{const a=await u.getInternalQrCode();a.success?(g.value="waiting",as.value=u.qrCode):f.value=a.message||"生成站内二维码失败"},ts=()=>{S&&clearInterval(S),S=setInterval(async()=>{const a=await u.checkQrStatus();a.status==="success"?(k.value="success",clearInterval(S),h.value=a.message,setTimeout(()=>{_.push("/")},1500)):a.status==="scanned"?k.value="scanned":a.status==="expired"&&(k.value="expired",clearInterval(S))},2e3)},is=()=>{L&&clearInterval(L),L=setInterval(async()=>{const a=await u.checkQrStatus();a.status==="success"?(g.value="success",clearInterval(L),h.value=a.message,setTimeout(()=>{_.push("/")},1500)):a.status==="scanned"?g.value="scanned":a.status==="expired"&&(g.value="expired",clearInterval(L))},2e3)},ns=()=>{W()},os=()=>{C.value==="official"?F():z()},us=()=>{w.value="account"},ds=async()=>{Q.value=!0,r.value="";try{const a=await u.verifyOfficialLogin();a.isValid?(r.value="检测到网易云音乐登录状态，正在同步...",b.value="success",setTimeout(()=>{_.push("/")},2e3)):(r.value=a.message||"未检测到登录状态，请先在网易云音乐网页版登录",b.value="info")}catch(a){console.error("检查官方登录状态失败:",a),r.value="检查失败，请重试",b.value="error"}finally{Q.value=!1}},rs=async()=>{$.value=!0,p.value=null,r.value="";try{if(r.value="正在检查网易云音乐web版登录状态...",b.value="info",(await u.syncLoginFromWeb()).success){r.value="成功获取登录状态，正在跳转...",b.value="success",setTimeout(()=>{_.push("/")},1500);return}r.value="未检测到登录状态，开始轮询检查...";const s=await u.pollWebLoginStatus({maxAttempts:30,interval:2e3,onProgress:d=>{p.value=d},onSuccess:d=>{r.value="成功获取登录状态，正在跳转...",b.value="success",p.value=null,setTimeout(()=>{_.push("/")},1500)},onError:d=>{r.value=d.message||"同步失败",b.value="error",p.value=null}});!s.success&&!p.value&&(r.value=s.message||"未检测到登录状态，请确保已在网易云音乐官网登录",b.value="info")}catch(a){console.error("Web版登录同步失败:",a),r.value="同步过程中发生错误，请重试",b.value="error",p.value=null}finally{$.value=!1}};return cs(()=>{if(u.isLoggedIn){_.push("/");return}w.value==="qr"&&W()}),fs(()=>{S&&clearInterval(S),L&&clearInterval(L)}),(a,s)=>{const d=bs("router-link");return t(),l("div",_s,[e("div",qs,[s[53]||(s[53]=e("div",{class:"login-header"},[e("h1",null,"NeuMusic"),e("p",null,"登录享受完整音乐体验")],-1)),e("div",hs,[e("div",xs,[s[20]||(s[20]=e("i",{class:"fas fa-info-circle"},null,-1)),s[21]||(s[21]=e("span",null,"已支持游客模式浏览，",-1)),ps(d,{to:"/",class:"guest-link"},{default:ms(()=>[...s[19]||(s[19]=[i("直接体验",-1)])]),_:1})])]),e("div",Cs,[e("div",Ss,[e("button",{class:c(["method-tab",{active:w.value==="official"}]),onClick:s[0]||(s[0]=o=>U("official"))},[...s[22]||(s[22]=[e("i",{class:"fas fa-shield-alt"},null,-1),i(" 官方登录 ",-1)])],2),e("button",{class:c(["method-tab",{active:w.value==="account"}]),onClick:s[1]||(s[1]=o=>U("account"))},[...s[23]||(s[23]=[e("i",{class:"fas fa-user"},null,-1),i(" 账号登录 ",-1)])],2),e("button",{class:c(["method-tab",{active:w.value==="qr"}]),onClick:s[2]||(s[2]=o=>U("qr"))},[...s[24]||(s[24]=[e("i",{class:"fas fa-qrcode"},null,-1),i(" 二维码登录 ",-1)])],2)])]),w.value==="official"?(t(),l("div",Ls,[e("div",Ms,[s[42]||(s[42]=e("div",{class:"official-header"},[e("h3",null,"网易云音乐登录"),e("p",null,"安全便捷的站内登录体验")],-1)),e("div",Ps,[e("div",Qs,[e("button",{class:c(["embedded-tab",{active:v.value==="phone"}]),onClick:s[3]||(s[3]=o=>D("phone"))},[...s[25]||(s[25]=[e("i",{class:"fas fa-mobile-alt"},null,-1),i(" 手机号 ",-1)])],2),e("button",{class:c(["embedded-tab",{active:v.value==="email"}]),onClick:s[4]||(s[4]=o=>D("email"))},[...s[26]||(s[26]=[e("i",{class:"fas fa-envelope"},null,-1),i(" 邮箱 ",-1)])],2),e("button",{class:c(["embedded-tab",{active:v.value==="qr"}]),onClick:s[5]||(s[5]=o=>D("qr"))},[...s[27]||(s[27]=[e("i",{class:"fas fa-qrcode"},null,-1),i(" 扫码 ",-1)])],2),e("button",{class:c(["embedded-tab",{active:v.value==="web"}]),onClick:s[6]||(s[6]=o=>D("web"))},[...s[28]||(s[28]=[e("i",{class:"fas fa-globe"},null,-1),i(" Web同步 ",-1)])],2)]),v.value==="phone"||v.value==="email"?(t(),l("div",$s,[e("div",Is,[e("i",{class:c(v.value==="phone"?"fas fa-mobile-alt":"fas fa-envelope")},null,2),N(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>I.value=o),placeholder:v.value==="phone"?"请输入手机号":"请输入邮箱",type:"text",disabled:x.value,onFocus:T},null,40,Ts),[[X,I.value]])]),e("div",Es,[s[29]||(s[29]=e("i",{class:"fas fa-lock"},null,-1)),N(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>V.value=o),placeholder:"请输入密码",type:B.value?"text":"password",disabled:x.value,onKeyup:Z(J,["enter"]),onFocus:T},null,40,As),[[Y,V.value]]),e("button",{type:"button",class:"password-toggle",onClick:s[9]||(s[9]=o=>B.value=!B.value),disabled:x.value},[e("i",{class:c(B.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,Vs)]),e("button",{class:"embedded-login-btn neu-button primary",onClick:J,disabled:x.value||!O.value},[x.value?(t(),l("i",Ds)):(t(),l("i",Ns)),i(" "+m(x.value?"登录中...":"登录"),1)],8,Bs)])):v.value==="qr"?(t(),l("div",Rs,[e("div",Us,[e("button",{class:c(["mode-option",{active:C.value==="official"}]),onClick:s[10]||(s[10]=o=>j("official"))},[...s[30]||(s[30]=[e("i",{class:"fas fa-external-link-alt"},null,-1),i(" 官方扫码 ",-1)])],2),e("button",{class:c(["mode-option",{active:C.value==="internal"}]),onClick:s[11]||(s[11]=o=>j("internal"))},[...s[31]||(s[31]=[e("i",{class:"fas fa-home"},null,-1),i(" 站内扫码 ",-1)])],2)]),e("div",Ws,[R(u).qrCode.qrimg&&g.value!=="expired"?(t(),l("img",{key:0,src:R(u).qrCode.qrimg,alt:"登录二维码",class:"embedded-qr-image"},null,8,Fs)):g.value==="expired"?(t(),l("div",zs,[...s[32]||(s[32]=[e("i",{class:"fas fa-exclamation-triangle"},null,-1),e("p",null,"二维码已过期",-1)])])):(t(),l("div",Ks,[...s[33]||(s[33]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在生成二维码...",-1)])]))]),e("div",Os,[g.value==="waiting"?(t(),l("p",js,[s[34]||(s[34]=e("i",{class:"fas fa-mobile-alt"},null,-1)),i(" "+m(C.value==="official"?"请使用网易云音乐APP扫码登录":"请使用扫码工具扫码在站内登录"),1)])):g.value==="scanned"?(t(),l("p",Js,[s[35]||(s[35]=e("i",{class:"fas fa-check-circle"},null,-1)),i(" "+m(C.value==="official"?"扫码成功，请在手机上确认登录":"扫码成功，请在页面中完成登录"),1)])):g.value==="expired"?(t(),l("p",Gs,[...s[36]||(s[36]=[e("i",{class:"fas fa-exclamation-triangle"},null,-1),i(" 二维码已过期，请刷新 ",-1)])])):y("",!0)]),C.value==="internal"?(t(),l("div",Hs,[...s[37]||(s[37]=[ss('<div class="info-item" data-v-3f459053><i class="fas fa-info-circle" data-v-3f459053></i><span data-v-3f459053>扫码后将在站内打开登录页面</span></div><div class="info-item" data-v-3f459053><i class="fas fa-shield-alt" data-v-3f459053></i><span data-v-3f459053>全程在站内完成，保证安全性</span></div><div class="info-item" data-v-3f459053><i class="fas fa-mobile-alt" data-v-3f459053></i><span data-v-3f459053>支持任何扫码工具或APP</span></div>',3)])])):y("",!0),e("div",Xs,[g.value==="expired"?(t(),l("button",{key:0,class:"neu-button primary",onClick:os},[...s[38]||(s[38]=[e("i",{class:"fas fa-redo-alt"},null,-1),i(" 刷新二维码 ",-1)])])):y("",!0)])])):v.value==="web"?(t(),l("div",Ys,[e("div",Zs,[s[40]||(s[40]=e("div",{class:"web-sync-header"},[e("i",{class:"fas fa-globe"}),e("h4",null,"网易云音乐Web版同步登录"),e("p",null,"自动检测并同步您在网易云音乐官网的登录状态")],-1)),e("div",se,[e("button",{class:"neu-button",onClick:ds,disabled:Q.value},[Q.value?(t(),l("i",ae)):(t(),l("i",le)),i(" "+m(Q.value?"检查中...":"检查登录状态"),1)],8,ee),e("button",{class:"neu-button primary",onClick:rs,disabled:$.value},[$.value?(t(),l("i",ie)):(t(),l("i",ne)),i(" "+m($.value?"同步中...":"自动同步登录"),1)],8,te)]),r.value?(t(),l("div",{key:0,class:c(["status-message",b.value])},[e("i",{class:c(b.value==="success"?"fas fa-check-circle":"fas fa-info-circle")},null,2),i(" "+m(r.value),1)],2)):y("",!0),p.value?(t(),l("div",oe,[e("div",ue,[s[39]||(s[39]=e("i",{class:"fas fa-search"},null,-1)),e("span",null,m(p.value.message),1)]),e("div",de,[e("div",{class:"progress-fill",style:gs({width:p.value.attempts/p.value.maxAttempts*100+"%"})},null,4)]),e("div",re,m(p.value.attempts)+" / "+m(p.value.maxAttempts),1)])):y("",!0),s[41]||(s[41]=ss('<div class="web-sync-instructions" data-v-3f459053><div class="instruction-item" data-v-3f459053><i class="fas fa-info-circle" data-v-3f459053></i><span data-v-3f459053>请先在网易云音乐官网登录，然后点击&quot;自动同步登录&quot;</span></div><div class="instruction-item" data-v-3f459053><i class="fas fa-shield-alt" data-v-3f459053></i><span data-v-3f459053>系统将自动检测您的登录状态并同步到本站</span></div><div class="instruction-item" data-v-3f459053><i class="fas fa-external-link-alt" data-v-3f459053></i><span data-v-3f459053>支持手机号、邮箱和二维码等多种登录方式</span></div></div>',1))])])):y("",!0)])])])):w.value==="account"?(t(),l("div",ce,[e("div",ve,[M.value==="email"?(t(),l("i",fe)):(t(),l("i",pe)),N(e("input",{"onUpdate:modelValue":s[12]||(s[12]=o=>P.value=o),placeholder:M.value==="email"?"请输入邮箱":"请输入手机号",type:"text",disabled:q.value,onFocus:s[13]||(s[13]=o=>f.value="")},null,40,me),[[X,P.value]])]),e("div",be,[s[43]||(s[43]=e("i",{class:"fas fa-lock"},null,-1)),N(e("input",{"onUpdate:modelValue":s[14]||(s[14]=o=>E.value=o),placeholder:"请输入密码",type:A.value?"text":"password",disabled:q.value,onKeyup:Z(G,["enter"]),onFocus:s[15]||(s[15]=o=>f.value="")},null,40,ge),[[Y,E.value]]),e("button",{type:"button",class:"password-toggle",onClick:s[16]||(s[16]=o=>A.value=!A.value),disabled:q.value},[e("i",{class:c(A.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,ye)]),e("div",ke,[e("button",{class:"login-btn neu-button primary",onClick:G,disabled:q.value||!K.value},[q.value?(t(),l("i",_e)):(t(),l("i",qe)),i(" "+m(q.value?"登录中...":"登录"),1)],8,we)]),e("div",he,[M.value==="phone"?(t(),l("a",{key:0,onClick:s[17]||(s[17]=o=>M.value="email")}," 使用邮箱登录 ")):(t(),l("a",{key:1,onClick:s[18]||(s[18]=o=>M.value="phone")}," 使用手机号登录 "))])])):w.value==="qr"?(t(),l("div",xe,[e("div",Ce,[R(u).qrCode.qrimg&&k.value!=="expired"?(t(),l("img",{key:0,src:R(u).qrCode.qrimg,alt:"登录二维码",class:"qr-image"},null,8,Se)):k.value==="expired"?(t(),l("div",Le,[...s[44]||(s[44]=[e("i",{class:"fas fa-exclamation-triangle"},null,-1),e("p",null,"二维码已过期",-1)])])):(t(),l("div",Me,[...s[45]||(s[45]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"正在生成二维码...",-1)])]))]),e("div",Pe,[k.value==="waiting"?(t(),l("p",Qe,[...s[46]||(s[46]=[e("i",{class:"fas fa-mobile-alt"},null,-1),i(" 请使用网易云音乐APP扫码登录 ",-1)])])):k.value==="scanned"?(t(),l("p",$e,[...s[47]||(s[47]=[e("i",{class:"fas fa-check-circle"},null,-1),i(" 扫码成功，请在手机上确认登录 ",-1)])])):k.value==="expired"?(t(),l("p",Ie,[...s[48]||(s[48]=[e("i",{class:"fas fa-exclamation-triangle"},null,-1),i(" 二维码已过期，请刷新 ",-1)])])):y("",!0)]),e("div",Te,[k.value==="expired"?(t(),l("button",{key:0,class:"neu-button primary",onClick:ns},[...s[49]||(s[49]=[e("i",{class:"fas fa-redo-alt"},null,-1),i(" 刷新二维码 ",-1)])])):y("",!0),e("button",{class:"neu-button",onClick:us},[...s[50]||(s[50]=[e("i",{class:"fas fa-user"},null,-1),i(" 使用账号登录 ",-1)])])])])):y("",!0),f.value?(t(),l("div",Ee,[s[51]||(s[51]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),i(" "+m(f.value),1)])):y("",!0),h.value?(t(),l("div",Ae,[s[52]||(s[52]=e("i",{class:"fas fa-check-circle"},null,-1)),i(" "+m(h.value),1)])):y("",!0),s[54]||(s[54]=e("div",{class:"login-notice"},[e("p",null,"登录即表示同意本站的用户协议和隐私政策"),e("p",null,"官方登录方式更安全，推荐使用"),e("div",{class:"official-verify-tip"},[e("i",{class:"fas fa-shield-alt"}),e("span",null,"使用网易云音乐官方接口验证登录状态，确保安全性")])],-1))])])}}},Ue=ys(Ve,[["__scopeId","data-v-3f459053"]]);export{Ue as default};
