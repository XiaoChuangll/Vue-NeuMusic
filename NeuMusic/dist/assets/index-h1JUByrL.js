const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-DGms9Fk5.js","assets/vendor-DY0UzM5c.js","assets/utils-DOv6pLCg.js","assets/Home-DmDhN-TI.css","assets/Discover-DTV_aNYV.js","assets/Discover-B9PxjP2G.css","assets/Search-BX6DFkEN.js","assets/Search-DAcWghsb.css","assets/Me-CcdEAKQb.js","assets/Me-CORQ0lfK.css","assets/Login-DACWmvqs.js","assets/Login-D-8C0phe.css","assets/QrLogin-3zs2RDRt.js","assets/QrLogin-VvtaHZ9P.css","assets/NowPlaying-rlPh6QMP.js","assets/NowPlaying-D1tpaRWx.css"])))=>i.map(i=>d[i]);
import{B as de,C as we,D as Ie,p as be,k as ve,r as A,c as M,w as G,o as he,E as ke,y as Se,a as g,h as d,b as t,s as H,d as x,x as te,e as D,n as V,l as F,v as ne,m as Le,u as _,t as v,q as le,A as ae,T as Ce,F as ce,f as ue,i as Pe,G as me,H as oe,I as re,J as $e,K as Me,L as xe,M as Ue}from"./vendor-DY0UzM5c.js";import{a as Te}from"./utils-DOv6pLCg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const Ae="modulepreload",De=function(e){return"/"+e},fe={},Q=function(s,o,a){let i=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),p=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(o.map(I=>{if(I=De(I),I in fe)return;fe[I]=!0;const b=I.endsWith(".css"),w=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${I}"]${w}`))return;const h=document.createElement("link");if(h.rel=b?"stylesheet":Ae,b||(h.as="script"),h.crossOrigin="",h.href=I,p&&h.setAttribute("nonce",p),document.head.appendChild(h),b)return new Promise((C,E)=>{h.addEventListener("load",C),h.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${I}`)))})}))}function l(r){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=r,window.dispatchEvent(p),!p.defaultPrevented)throw r}return i.then(r=>{for(const p of r||[])p.status==="rejected"&&l(p.reason);return s().catch(l)})},Ee="http://139.9.223.233:3000/",y=Te.create({baseURL:localStorage.getItem("apiUrl")||Ee,timeout:1e4,withCredentials:!0});y.interceptors.request.use(e=>{const s=localStorage.getItem("cookie");return s&&(e.params={...e.params,cookie:s}),e},e=>Promise.reject(e));y.interceptors.response.use(e=>{const{data:s}=e;return s.code===301?(localStorage.removeItem("cookie"),localStorage.removeItem("userInfo"),window.location.reload(),Promise.reject(new Error("需要登录"))):s},e=>(console.error("API 请求错误:",e),Promise.reject(e)));const Ve=e=>{y.defaults.baseURL=e,localStorage.setItem("apiUrl",e)},pe=Object.freeze(Object.defineProperty({__proto__:null,default:y,setApiUrl:Ve},Symbol.toStringTag,{value:"Module"})),T={loginByPhone(e,s,o="",a="86"){return y({url:"/login/cellphone",method:"post",data:{phone:e,password:s,captcha:o,countrycode:a,timestamp:Date.now()}})},loginByEmail(e,s,o=""){return y({url:"/login",method:"post",data:{email:e,password:s,captcha:o,timestamp:Date.now()}})},getQrKey(){return y({url:"/login/qr/key",method:"get",params:{timestamp:Date.now()}})},getQrCode(e){return y({url:"/login/qr/create",method:"get",params:{key:e,qrimg:!0,timestamp:Date.now()}})},async generateInternalQrCode(e){try{const s=`${window.location.origin}/login/qr?key=${e}&t=${Date.now()}`;return{success:!0,code:200,data:{qrimg:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(s)}`,qrurl:s}}}catch(s){return console.error("生成站内二维码失败:",s),{success:!1,code:-1,message:"生成二维码失败"}}},async handleInternalQrLogin(e,s){try{return e?await y({url:"/login/qr/confirm",method:"post",data:{key:e,...s,timestamp:Date.now()}}):{success:!1,message:"无效的登录key"}}catch(o){return console.error("处理站内二维码登录失败:",o),{success:!1,message:"登录处理失败"}}},checkQrStatus(e){return y({url:"/login/qr/check",method:"get",params:{key:e,timestamp:Date.now()}})},getLoginStatus(){return y({url:"/login/status",method:"post",params:{timestamp:Date.now()}})},checkLoginStatus(){return y({url:"/user/account",method:"get",params:{timestamp:Date.now()}})},async verifyLoginStatus(){var e,s;try{const o=await this.getLoginStatus();if(((e=o.data)==null?void 0:e.code)!==200)return{isValid:!1,code:((s=o.data)==null?void 0:s.code)||-1,message:"登录状态无效"};const a=await this.checkLoginStatus();return a.code===200&&a.account?{isValid:!0,code:200,account:a.account,profile:a.profile,message:"登录状态有效"}:{isValid:!1,code:a.code||-1,message:"账号信息验证失败"}}catch(o){return console.error("验证登录状态失败:",o),{isValid:!1,code:-1,message:"网络错误",error:o}}},async getOfficialLoginStatus(){try{const e=await fetch("https://music.163.com/api/nuser/account/get",{method:"GET",credentials:"include",headers:{Referer:"https://music.163.com/","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(e.ok){const s=await e.json();return{isValid:s.code===200&&s.account,code:s.code,account:s.account,profile:s.profile,message:s.code===200?"登录状态有效":"登录状态无效"}}else return{isValid:!1,code:e.status,message:"网络请求失败"}}catch(e){return console.error("获取官方登录状态失败:",e),{isValid:!1,code:-1,message:"网络错误",error:e}}},async syncLoginFromWeb(){try{console.log("开始从网易云音乐web版同步登录状态...");const e=document.cookie;console.log("当前cookie状态:",e?"存在":"无");const s=await this.getOfficialLoginStatus();if(s.isValid){console.log("检测到网易云音乐web版登录状态:",s);const o=await fetch("https://music.163.com/api/v1/user/detail/"+s.account.id,{method:"GET",credentials:"include",headers:{Referer:"https://music.163.com/","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});let a=null;if(o.ok){const i=await o.json();i.code===200&&(a=i)}return{success:!0,code:200,account:s.account,profile:s.profile,userDetail:a,cookie:e,message:"成功从网易云音乐web版同步登录状态"}}else return{success:!1,code:s.code||-1,message:s.message||"未检测到网易云音乐web版登录状态"}}catch(e){return console.error("同步网易云音乐web版登录状态失败:",e),{success:!1,code:-1,message:"同步登录状态时发生错误",error:e}}},async pollWebLoginStatus(e={}){const{maxAttempts:s=30,interval:o=2e3,onProgress:a=null,onSuccess:i=null,onError:l=null}=e;let r=0;return new Promise((p,I)=>{const b=async()=>{r++;try{a&&a({attempts:r,maxAttempts:s,message:`正在检查登录状态... (${r}/${s})`});const w=await this.syncLoginFromWeb();if(w.success){i&&i(w),p(w);return}if(r>=s){const h={success:!1,code:-1,message:`已尝试${s}次，未检测到登录状态`};l&&l(h),p(h);return}setTimeout(b,o)}catch(w){console.error("轮询检查登录状态时发生错误:",w);const h={success:!1,code:-1,message:"检查登录状态时发生错误",error:w};l&&l(h),I(h)}};b()})},async checkCrossDomainCookie(){try{return new Promise(e=>{const s=document.createElement("iframe");s.style.display="none",s.src="https://music.163.com/api/nuser/account/get";const o=setTimeout(()=>{document.body.removeChild(s),e({success:!1,message:"检查cookie超时"})},5e3);s.onload=async()=>{clearTimeout(o);try{const a=await this.syncLoginFromWeb();document.body.removeChild(s),e(a)}catch(a){document.body.removeChild(s),e({success:!1,message:"获取登录状态失败",error:a})}},s.onerror=()=>{clearTimeout(o),document.body.removeChild(s),e({success:!1,message:"无法访问网易云音乐"})},document.body.appendChild(s)})}catch(e){return console.error("检查跨域cookie失败:",e),{success:!1,message:"检查cookie时发生错误",error:e}}},async comprehensiveLoginCheck(){try{const e=await this.getOfficialLoginStatus();return e.isValid?(console.log("官方接口验证成功"),e):(console.log("官方接口验证失败，使用备用接口"),await this.verifyLoginStatus())}catch(e){return console.error("综合登录状态检查失败:",e),await this.verifyLoginStatus()}},refreshLoginStatus(){return y({url:"/login/refresh",method:"post"})},logout(){return y({url:"/logout",method:"post"})},getUserDetail(e){return y({url:"/user/detail",method:"get",params:{uid:e}})},getUserAccount(){return y({url:"/user/account",method:"get"})},getUserPlaylists(e,s=30,o=0){return y({url:"/user/playlist",method:"get",params:{uid:e,limit:s,offset:o}})},getUserLikeList(e){return y({url:"/likelist",method:"get",params:{uid:e}})},getUserFollowedArtists(e=30,s=0){return y({url:"/artist/sublist",method:"get",params:{limit:e,offset:s}})},getUserFollowedAlbums(e=30,s=0){return y({url:"/album/sublist",method:"get",params:{limit:e,offset:s}})},getUserFollowedMVs(e=30,s=0){return y({url:"/mv/sublist",method:"get",params:{limit:e,offset:s}})},refreshLogin(){return y({url:"/login/refresh",method:"post"})}},B={search(e,s=1,o=30,a=0){return y({url:"/search",method:"get",params:{keywords:e,type:s,limit:o,offset:a}})},getSongDetail(e){return y({url:"/song/detail",method:"get",params:{ids:Array.isArray(e)?e.join(","):e}})},getSongUrl(e,s=32e4){return y({url:"/song/url",method:"get",params:{id:e,br:s}})},getLyric(e){return y({url:"/lyric",method:"get",params:{id:e}})},getPlaylistDetail(e){return y({url:"/playlist/detail",method:"get",params:{id:e}})},getPlaylistTracks(e,s=1e3,o=0){return y({url:"/playlist/track/all",method:"get",params:{id:e,limit:s,offset:o}})},getPersonalized(e=10){return y({url:"/personalized",method:"get",params:{limit:e}})},getPersonalizedNewsong(e=10){return y({url:"/personalized/newsong",method:"get",params:{limit:e}})},getRecommendResource(){return y({url:"/recommend/resource",method:"get"})},getRecommendSongs(){return y({url:"/recommend/songs",method:"get"})},getTopArtists({area:e=-1,type:s=-1,limit:o=50,offset:a=0}={}){return y({url:"/top/artists",method:"get",params:{area:e,type:s,limit:o,offset:a}})},getArtistDetail(e){return y({url:"/artist/detail",method:"get",params:{id:e}})},getArtistTopSongs(e){return y({url:"/artist/top/song",method:"get",params:{id:e}})},getAlbumDetail(e){return y({url:"/album",method:"get",params:{id:e}})},getBanner(e=0){return y({url:"/banner",method:"get",params:{type:e}})},getTopPlaylists(e="",s=50,o=0){return y({url:"/top/playlist",method:"get",params:{cat:e,limit:s,offset:o}})},getToplistDetail(){return y({url:"/toplist/detail",method:"get"})},likeSong(e,s=!0){return y({url:"/like",method:"get",params:{id:e,like:s?"true":"false"}})},getSimiSong(e){return y({url:"/simi/song",method:"get",params:{id:e}})},getSongComments(e,s=20,o=0){return y({url:"/comment/music",method:"get",params:{id:e,limit:s,offset:o}})},getSearchHot(){return y({url:"/search/hot",method:"get"})},getSearchSuggest(e){return y({url:"/search/suggest",method:"get",params:{keywords:e}})}},N={formatTime(e){const s=Math.floor(e/60),o=Math.floor(e%60);return`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},formatPlayCount(e){return e<1e4?e.toString():e<1e8?`${Math.floor(e/1e4)}万`:`${Math.floor(e/1e8)}亿`},formatFileSize(e){return e<1024?`${e}B`:e<1024*1024?`${(e/1024).toFixed(1)}KB`:`${(e/(1024*1024)).toFixed(1)}MB`},getImageUrl(e,s=300){return e?`${e}?param=${s}y${s}`:""},debounce(e,s){let o;return function(...i){const l=()=>{clearTimeout(o),e(...i)};clearTimeout(o),o=setTimeout(l,s)}},throttle(e,s){let o;return function(...i){o||(e.apply(this,i),o=!0,setTimeout(()=>o=!1,s))}}},Y=de("user",{state:()=>({isLoggedIn:!1,userInfo:null,userDetail:null,userPlaylists:[],createdPlaylists:[],subscribedPlaylists:[],likedSongs:[],loginMethod:1,qrCode:{key:"",qrimg:"",status:0},loginCheckInterval:null,lastVerifyTime:null}),getters:{userId:e=>{var s,o,a;return((s=e.userInfo)==null?void 0:s.userId)||((a=(o=e.userInfo)==null?void 0:o.account)==null?void 0:a.id)},nickname:e=>{var s,o,a,i;return((o=(s=e.userInfo)==null?void 0:s.profile)==null?void 0:o.nickname)||((i=(a=e.userDetail)==null?void 0:a.profile)==null?void 0:i.nickname)},avatarUrl:e=>{var s,o,a,i;return((o=(s=e.userInfo)==null?void 0:s.profile)==null?void 0:o.avatarUrl)||((i=(a=e.userDetail)==null?void 0:a.profile)==null?void 0:i.avatarUrl)},isLiked:e=>s=>e.likedSongs.some(o=>o.id===s)},actions:{async loginByPhone(e,s,o=""){try{console.log("开始手机号登录验证...");const a=await T.loginByPhone(e,s,o);return a.code===200?(console.log("手机号登录成功",a),this.setUserInfo(a),await this.verifyLoginStatus()?{success:!0,message:"登录成功"}:{success:!1,message:"登录状态验证失败"}):a.code===502?{success:!1,message:"账号或密码错误"}:a.code===509?{success:!1,message:"验证码错误"}:{success:!1,message:a.message||"登录失败"}}catch(a){return console.error("手机号登录失败:",a),{success:!1,message:"网络错误，请重试"}}},async loginByEmail(e,s,o=""){try{console.log("开始邮箱登录验证...");const a=await T.loginByEmail(e,s,o);return a.code===200?(console.log("邮箱登录成功",a),this.setUserInfo(a),await this.verifyLoginStatus()?{success:!0,message:"登录成功"}:{success:!1,message:"登录状态验证失败"}):a.code===502?{success:!1,message:"账号或密码错误"}:a.code===509?{success:!1,message:"验证码错误"}:{success:!1,message:a.message||"登录失败"}}catch(a){return console.error("邮箱登录失败:",a),{success:!1,message:"网络错误，请重试"}}},async getQrCode(){try{const e=await T.getQrKey();if(e.code===200){this.qrCode.key=e.data.unikey;const s=await T.getQrCode(this.qrCode.key);if(s.code===200)return this.qrCode.qrimg=s.data.qrimg,{success:!0}}return{success:!1,message:"获取二维码失败"}}catch(e){return console.error("获取二维码失败:",e),{success:!1,message:"网络错误，请重试"}}},async getInternalQrCode(){try{const e=await T.getQrKey();if(e.code===200){this.qrCode.key=e.data.unikey;const s=await T.generateInternalQrCode(this.qrCode.key);if(s.success)return this.qrCode.qrimg=s.data.qrimg,this.qrCode.qrurl=s.data.qrurl,{success:!0}}return{success:!1,message:"获取站内二维码失败"}}catch(e){return console.error("获取站内二维码失败:",e),{success:!1,message:"网络错误，请重试"}}},async handleInternalQrLogin(e,s){try{const o=await T.handleInternalQrLogin(e,s);return o.success?(this.setUserInfo(o),{success:!0,message:"登录成功"}):{success:!1,message:o.message||"登录失败"}}catch(o){return console.error("处理站内二维码登录失败:",o),{success:!1,message:"网络错误，请重试"}}},async checkQrStatus(){try{const e=await T.checkQrStatus(this.qrCode.key);return this.qrCode.status=e.code,e.code===803?(console.log("二维码登录成功",e),this.setUserInfo(e),await this.verifyLoginStatus()?{success:!0,status:"success",message:"登录成功"}:{success:!1,status:"failed",message:"登录状态验证失败"}):e.code===801?{success:!0,status:"waiting"}:e.code===802?{success:!0,status:"scanned"}:e.code===800?{success:!1,status:"expired"}:{success:!1,status:"error",message:"未知状态"}}catch(e){return console.error("检查二维码状态失败:",e),{success:!1,status:"error",message:"网络错误"}}},setUserInfo(e){this.isLoggedIn=!0,this.userInfo=e,this.lastVerifyTime=Date.now(),e.cookie&&localStorage.setItem("cookie",e.cookie),localStorage.setItem("userInfo",JSON.stringify(e)),localStorage.setItem("lastVerifyTime",this.lastVerifyTime.toString()),this.fetchUserDetail(),this.fetchUserPlaylists(),this.fetchLikeList(),this.scheduleLoginStatusCheck()},async fetchUserDetail(){try{if(this.userId){const e=await T.getUserDetail(this.userId);e.code===200&&(this.userDetail=e)}}catch(e){console.error("获取用户详情失败:",e)}},async fetchUserPlaylists(){try{if(this.userId){const e=await T.getUserPlaylists(this.userId);e.code===200&&(this.userPlaylists=e.playlist,this.createdPlaylists=e.playlist.filter(s=>s.userId===this.userId),this.subscribedPlaylists=e.playlist.filter(s=>s.userId!==this.userId))}}catch(e){console.error("获取用户歌单失败:",e)}},async fetchLikeList(){try{if(this.userId){const e=await T.getUserLikeList(this.userId);e.code===200&&(this.likedSongs=e.ids||[])}}catch(e){console.error("获取喜欢的音乐列表失败:",e)}},addToLikedSongs(e){this.likedSongs.some(s=>s.id===e.id)||this.likedSongs.unshift(e)},removeFromLikedSongs(e){this.likedSongs=this.likedSongs.filter(s=>s.id!==e)},async logout(){try{await T.logout()}catch(e){console.error("退出登录失败:",e)}finally{this.isLoggedIn=!1,this.userInfo=null,this.userDetail=null,this.userPlaylists=[],this.createdPlaylists=[],this.subscribedPlaylists=[],this.likedSongs=[],this.qrCode={key:"",qrimg:"",status:0},this.lastVerifyTime=null,this.loginCheckInterval&&(clearInterval(this.loginCheckInterval),this.loginCheckInterval=null),localStorage.removeItem("cookie"),localStorage.removeItem("userInfo"),localStorage.removeItem("lastVerifyTime")}},async restoreLoginState(){const e=localStorage.getItem("cookie"),s=localStorage.getItem("userInfo"),o=localStorage.getItem("lastVerifyTime");if(e&&s)try{if(console.log("开始恢复登录状态..."),this.isLoggedIn=!0,this.userInfo=JSON.parse(s),this.lastVerifyTime=o?parseInt(o):Date.now(),Date.now()-this.lastVerifyTime>15*60*1e3){if(console.log("登录状态超过15分钟未验证，立即进行网易云官方验证"),!await this.verifyLoginStatus())return console.log("登录状态验证失败，清除本地状态"),!1}else console.log("恢复登录状态，加载本地数据"),this.fetchUserDetail(),this.fetchUserPlaylists(),this.fetchLikeList();return this.scheduleLoginStatusCheck(),console.log("登录状态恢复成功"),!0}catch(a){return console.error("恢复登录状态失败:",a),this.logout(),!1}return console.log("未找到本地登录信息"),!1},async verifyOfficialLogin(){try{console.log("开始验证网易云官方登录状态...");const e=await T.getOfficialLoginStatus();if(e.isValid){console.log("网易云官方登录状态验证成功",e);const s={code:200,account:e.account,profile:e.profile,cookie:document.cookie};return this.setUserInfo(s),{isValid:!0,code:200,account:e.account,profile:e.profile,message:"官方登录状态有效"}}else return console.log("网易云官方登录状态验证失败:",e.message),{isValid:!1,code:e.code||-1,message:e.message||"未检测到官方登录状态"}}catch(e){return console.error("验证网易云官方登录状态失败:",e),{isValid:!1,code:-1,message:"网络错误或接口异常",error:e}}},async syncLoginFromWeb(){try{console.log("开始从网易云音乐web版同步登录状态...");const e=await T.syncLoginFromWeb();if(e.success){console.log("成功从web版同步登录状态:",e);const s={code:200,account:e.account,profile:e.profile,userDetail:e.userDetail,cookie:e.cookie};return this.setUserInfo(s),{success:!0,code:200,account:e.account,profile:e.profile,message:"成功从网易云音乐web版同步登录状态"}}else return console.log("从web版同步登录状态失败:",e.message),{success:!1,code:e.code||-1,message:e.message||"未检测到web版登录状态"}}catch(e){return console.error("从web版同步登录状态失败:",e),{success:!1,code:-1,message:"同步登录状态时发生错误",error:e}}},async pollWebLoginStatus(e={}){const o={...{maxAttempts:30,interval:2e3,onProgress:null,onSuccess:null,onError:null},...e};try{return console.log("开始轮询检查web版登录状态..."),await T.pollWebLoginStatus({...o,onProgress:i=>{console.log("轮询进度:",i),o.onProgress&&o.onProgress(i)},onSuccess:i=>{console.log("轮询检查成功:",i);const l={code:200,account:i.account,profile:i.profile,userDetail:i.userDetail,cookie:i.cookie};this.setUserInfo(l),o.onSuccess&&o.onSuccess(i)},onError:i=>{console.log("轮询检查失败:",i),o.onError&&o.onError(i)}})}catch(a){return console.error("轮询检查web版登录状态失败:",a),{success:!1,code:-1,message:"轮询检查时发生错误",error:a}}},async checkCrossDomainCookie(){try{console.log("开始检查跨域cookie...");const e=await T.checkCrossDomainCookie();if(e.success){console.log("跨域cookie检查成功:",e);const s={code:200,account:e.account,profile:e.profile,userDetail:e.userDetail,cookie:e.cookie};this.setUserInfo(s)}return e}catch(e){return console.error("检查跨域cookie失败:",e),{success:!1,code:-1,message:"检查跨域cookie时发生错误",error:e}}},async verifyLoginStatus(){var e,s,o,a,i;try{console.log("开始验证登录状态...");const l=await T.comprehensiveLoginCheck();if(l.isValid)return console.log("登录状态验证成功",l),(l.account||l.profile)&&(this.userInfo={...this.userInfo,account:l.account||((e=this.userInfo)==null?void 0:e.account),profile:l.profile||((s=this.userInfo)==null?void 0:s.profile)},localStorage.setItem("userInfo",JSON.stringify(this.userInfo))),this.fetchUserDetail(),this.fetchUserPlaylists(),this.fetchLikeList(),this.lastVerifyTime=Date.now(),localStorage.setItem("lastVerifyTime",this.lastVerifyTime.toString()),!0;if(console.log("登录状态验证失败:",l.message),l.code===301||l.code===400||l.code===401)console.log("登录已过期，需要重新登录"),this.logout();else{if(l.error&&(l.error.code==="NETWORK_ERROR"||(o=l.message)!=null&&o.includes("网络")))return console.log("网络错误，保持当前状态"),!1;this.logout()}return!1}catch(l){return console.error("验证登录状态发生异常:",l),l.code==="NETWORK_ERROR"||(a=l.message)!=null&&a.includes("network")||(i=l.message)!=null&&i.includes("网络")?(console.log("网络异常，保持当前状态"),!1):(this.logout(),!1)}},async scheduleLoginStatusCheck(){this.loginCheckInterval&&clearInterval(this.loginCheckInterval),this.isLoggedIn&&(this.loginCheckInterval=setInterval(async()=>{this.isLoggedIn&&await this.verifyLoginStatus()},5*60*1e3))},async refreshLoginStatus(){try{return(await T.refreshLoginStatus()).code===200?(console.log("登录状态刷新成功"),!0):!1}catch(e){return console.error("刷新登录状态失败:",e),!1}},setLoginMethod(e){this.loginMethod=e}}}),ee=de("player",{state:()=>({isPlaying:!1,currentSong:null,playlist:[],currentIndex:0,playMode:0,currentTime:0,duration:0,volume:.8,currentUrl:"",lyric:null,shuffledIndexes:[],shuffledIndex:0,playHistory:[],audio:null}),getters:{progress:e=>e.duration?e.currentTime/e.duration*100:0,formattedCurrentTime:e=>ye(e.currentTime),formattedDuration:e=>ye(e.duration),hasPrevious:e=>e.playMode===2?e.shuffledIndex>0:e.currentIndex>0,hasNext:e=>e.playMode===2?e.shuffledIndex<e.shuffledIndexes.length-1:e.currentIndex<e.playlist.length-1,playModeText:e=>["顺序播放","单曲循环","随机播放"][e.playMode]},actions:{initAudio(){this.audio||(this.audio=new Audio,this.audio.volume=this.volume,this.audio.addEventListener("play",()=>{this.isPlaying=!0}),this.audio.addEventListener("pause",()=>{this.isPlaying=!1}),this.audio.addEventListener("ended",()=>{this.next()}),this.audio.addEventListener("timeupdate",()=>{this.currentTime=this.audio.currentTime}),this.audio.addEventListener("durationchange",()=>{this.duration=this.audio.duration||0}),this.audio.addEventListener("error",e=>{console.error("音频播放错误:",e),this.next()}))},async playSong(e,s=null,o=0){s&&(this.playlist=s,this.currentIndex=o,this.generateShuffledIndexes()),this.currentSong=e,this.addToHistory(e),await this.getSongUrl(e.id),await this.getLyric(e.id),this.saveToLocalStorage()},async getSongUrl(e){var s;try{const o=await B.getSongUrl(e);o.code===200&&((s=o.data[0])!=null&&s.url)?(this.currentUrl=o.data[0].url,this.audio&&(this.audio.src=this.currentUrl,this.play())):(console.error("获取播放URL失败"),this.next())}catch(o){console.error("获取播放URL失败:",o),this.next()}},async getLyric(e){try{const s=await B.getLyric(e);s.code===200&&(this.lyric=s)}catch(s){console.error("获取歌词失败:",s),this.lyric=null}},play(){this.audio&&this.currentUrl&&this.audio.play().catch(e=>{console.error("播放失败:",e)})},pause(){this.audio&&this.audio.pause()},togglePlay(){this.isPlaying?this.pause():this.play()},previous(){this.playlist.length&&(this.playMode===2?this.shuffledIndex>0&&(this.shuffledIndex--,this.currentIndex=this.shuffledIndexes[this.shuffledIndex]):this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.playlist.length-1,this.playSong(this.playlist[this.currentIndex]))},next(){if(this.playlist.length){if(this.playMode===1){this.play();return}this.playMode===2?this.shuffledIndex<this.shuffledIndexes.length-1?(this.shuffledIndex++,this.currentIndex=this.shuffledIndexes[this.shuffledIndex]):(this.generateShuffledIndexes(),this.shuffledIndex=0,this.currentIndex=this.shuffledIndexes[0]):this.currentIndex=this.currentIndex<this.playlist.length-1?this.currentIndex+1:0,this.playSong(this.playlist[this.currentIndex])}},togglePlayMode(){this.playMode=(this.playMode+1)%3,this.playMode===2&&this.generateShuffledIndexes(),this.saveToLocalStorage()},generateShuffledIndexes(){this.shuffledIndexes=[...Array(this.playlist.length).keys()];for(let e=this.shuffledIndexes.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[this.shuffledIndexes[e],this.shuffledIndexes[s]]=[this.shuffledIndexes[s],this.shuffledIndexes[e]]}this.shuffledIndex=this.shuffledIndexes.indexOf(this.currentIndex)},setPlaylist(e,s=0){this.playlist=e,this.currentIndex=s,this.generateShuffledIndexes(),e.length>0&&s<e.length&&this.playSong(e[s])},seek(e){if(this.audio&&this.duration){const s=Math.max(0,Math.min(e,this.duration));this.audio.currentTime=s,this.currentTime=s}},toggleMute(){this.audio&&(this.audio.muted=!this.audio.muted)},get isMuted(){return this.audio?this.audio.muted:!1},setVolume(e){this.volume=e,this.audio&&(this.audio.volume=e),this.saveToLocalStorage()},addToPlaylist(e){this.playlist.findIndex(o=>o.id===e.id)===-1&&this.playlist.push(e)},removeFromPlaylist(e){e<this.currentIndex?this.currentIndex--:e===this.currentIndex&&(this.playlist.length>1?this.next():(this.currentSong=null,this.pause())),this.playlist.splice(e,1),this.playMode===2&&this.generateShuffledIndexes()},clearPlaylist(){this.playlist=[],this.currentIndex=0,this.currentSong=null,this.shuffledIndexes=[],this.shuffledIndex=0,this.pause()},addToHistory(e){const s=this.playHistory.findIndex(o=>o.id===e.id);s!==-1&&this.playHistory.splice(s,1),this.playHistory.unshift({...e,playTime:Date.now()}),this.playHistory.length>100&&(this.playHistory=this.playHistory.slice(0,100))},saveToLocalStorage(){const e={currentSong:this.currentSong,playlist:this.playlist,currentIndex:this.currentIndex,playMode:this.playMode,volume:this.volume,playHistory:this.playHistory};localStorage.setItem("playerState",JSON.stringify(e))},restoreFromLocalStorage(){const e=localStorage.getItem("playerState");if(e)try{const s=JSON.parse(e);this.currentSong=s.currentSong,this.playlist=s.playlist||[],this.currentIndex=s.currentIndex||0,this.playMode=s.playMode||0,this.volume=s.volume||.8,this.playHistory=s.playHistory||[],this.audio&&(this.audio.volume=this.volume),this.playMode===2&&this.playlist.length&&this.generateShuffledIndexes(),console.log("播放器状态恢复成功")}catch(s){console.error("恢复播放状态失败:",s)}},getPlayHistory(e=20){return this.playHistory.slice(0,e)},clearPlayHistory(){this.playHistory=[],this.saveToLocalStorage()},destroy(){this.audio&&(this.audio.pause(),this.audio.src="",this.audio=null)}}});function ye(e){if(!e||e===1/0||isNaN(e))return"00:00";const s=Math.floor(e/60),o=Math.floor(e%60);return`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}const X=de("app",{state:()=>({apiUrl:localStorage.getItem("apiUrl")||"http://139.9.223.233:3000/",currentPage:"home",loading:!1,searchKeyword:"",searchType:1,theme:localStorage.getItem("theme")||"light",language:localStorage.getItem("language")||"zh-CN",showLyrics:localStorage.getItem("showLyrics")==="true",lyricsPosition:localStorage.getItem("lyricsPosition")||"bottom",audioQuality:localStorage.getItem("audioQuality")||"standard",autoPlay:localStorage.getItem("autoPlay")!=="false",errorMessage:"",successMessage:"",modals:{artistModal:!1,playlistModal:!1,settingsModal:!1},currentPlaylistId:null,currentArtistId:null}),getters:{searchTypeText:e=>({1:"单曲",10:"专辑",100:"歌手",1e3:"歌单"})[e.searchType]||"单曲",audioQualityText:e=>({standard:"标准",high:"高品质",lossless:"无损"})[e.audioQuality]||"标准",audioBitrate:e=>({standard:128e3,high:32e4,lossless:999e3})[e.audioQuality]||128e3},actions:{setCurrentPage(e){this.currentPage=e},setLoading(e){this.loading=e},setApiUrl(e){this.apiUrl=e,localStorage.setItem("apiUrl",e),Q(async()=>{const{setApiUrl:s}=await Promise.resolve().then(()=>pe);return{setApiUrl:s}},void 0).then(({setApiUrl:s})=>{s(e)})},setSearchKeyword(e){this.searchKeyword=e},setSearchType(e){this.searchType=e},setTheme(e){this.theme=e,localStorage.setItem("theme",e),document.documentElement.setAttribute("data-theme",e)},setLanguage(e){this.language=e,localStorage.setItem("language",e)},setShowLyrics(e){this.showLyrics=e,localStorage.setItem("showLyrics",e.toString())},setLyricsPosition(e){this.lyricsPosition=e,localStorage.setItem("lyricsPosition",e)},setAudioQuality(e){this.audioQuality=e,localStorage.setItem("audioQuality",e)},setAutoPlay(e){this.autoPlay=e,localStorage.setItem("autoPlay",e.toString())},showError(e,s=3e3){this.errorMessage=e,s>0&&setTimeout(()=>{this.errorMessage=""},s)},showSuccess(e,s=3e3){this.successMessage=e,s>0&&setTimeout(()=>{this.successMessage=""},s)},clearMessages(){this.errorMessage="",this.successMessage=""},showModal(e){this.modals[e]=!0},hideModal(e){this.modals[e]=!1},hideAllModals(){Object.keys(this.modals).forEach(e=>{this.modals[e]=!1})},showPlaylistModal(e){this.currentPlaylistId=e,this.showModal("playlistModal")},showArtistModal(e){this.currentArtistId=e,this.showModal("artistModal")},showInfo(e,s=3e3){this.showSuccess(e,s)},initializeApp(){document.documentElement.setAttribute("data-theme",this.theme),Q(async()=>{const{setApiUrl:e}=await Promise.resolve().then(()=>pe);return{setApiUrl:e}},void 0).then(({setApiUrl:e})=>{e(this.apiUrl)})},resetSettings(){this.apiUrl="http://139.9.223.233:3000/",this.theme="light",this.language="zh-CN",this.showLyrics=!1,this.lyricsPosition="bottom",this.audioQuality="standard",this.autoPlay=!0,["apiUrl","theme","language","showLyrics","lyricsPosition","audioQuality","autoPlay"].forEach(s=>localStorage.removeItem(s)),this.initializeApp()}}}),qe=Object.freeze(Object.defineProperty({__proto__:null,useAppStore:X,usePlayerStore:ee,useUserStore:Y},Symbol.toStringTag,{value:"Module"})),Re=()=>Q(()=>import("./Home-DGms9Fk5.js"),__vite__mapDeps([0,1,2,3])),Oe=()=>Q(()=>import("./Discover-DTV_aNYV.js"),__vite__mapDeps([4,1,2,5])),Ne=()=>Q(()=>import("./Search-BX6DFkEN.js"),__vite__mapDeps([6,1,2,7])),Qe=()=>Q(()=>import("./Me-CcdEAKQb.js"),__vite__mapDeps([8,1,2,9])),Fe=()=>Q(()=>import("./Login-DACWmvqs.js"),__vite__mapDeps([10,1,2,11])),He=()=>Q(()=>import("./QrLogin-3zs2RDRt.js"),__vite__mapDeps([12,1,2,13])),Be=()=>Q(()=>import("./NowPlaying-rlPh6QMP.js"),__vite__mapDeps([14,1,2,15])),Ke=[{path:"/",name:"Home",component:Re,meta:{title:"首页",requiresAuth:!1}},{path:"/discover",name:"Discover",component:Oe,meta:{title:"发现音乐",requiresAuth:!1}},{path:"/search",name:"Search",component:Ne,meta:{title:"搜索",requiresAuth:!1}},{path:"/now-playing",name:"NowPlaying",component:Be,meta:{title:"正在播放",requiresAuth:!1}},{path:"/me",name:"Me",component:Qe,meta:{title:"我的音乐",requiresAuth:!1}},{path:"/login",name:"Login",component:Fe,meta:{title:"登录",requiresAuth:!1}},{path:"/login/qr",name:"QrLogin",component:He,meta:{title:"扫码登录",requiresAuth:!1}},{path:"/home",redirect:"/"},{path:"/:pathMatch(.*)*",redirect:"/"}],_e=we({history:Ie(),routes:Ke,scrollBehavior(e,s,o){return o||{top:0}}});_e.beforeEach((e,s,o)=>{const a=Y();e.meta.title&&(document.title=`${e.meta.title} - Vue NeuMusic`),e.meta.requiresAuth&&!a.isLoggedIn?o({name:"Login",query:{redirect:e.fullPath}}):e.name==="Login"&&a.isLoggedIn?o({name:"Home"}):o()});const Z=(e,s)=>{const o=e.__vccOpts||e;for(const[a,i]of s)o[a]=i;return o},We={class:"navigation"},je={class:"nav-buttons"},ze=["disabled"],Je=["disabled"],Ge={class:"nav-links"},Xe={class:"nav-toolbar"},Ye={class:"search-container"},Ze={class:"user-container"},es={key:0,class:"user-info"},ss={class:"user-nickname"},ts=["src","alt"],os={key:1,class:"fas fa-user-alt avatar-icon"},as={class:"menu-header"},ls={class:"menu-avatar"},is=["src","alt"],rs={key:1,class:"fas fa-user"},ns={class:"menu-info"},cs={class:"menu-name"},us={class:"menu-status"},ds={class:"menu-items"},hs={__name:"Navigation",setup(e){const s=be(),o=ve(),a=Y(),i=ee(),l=X(),r=A(""),p=A(!1),I=M(()=>i.currentSong),b=M(()=>window.history.length>1),w=M(()=>!1),h=N.debounce(P=>{P.trim()&&(l.setSearchKeyword(P),s.push({name:"Search",query:{q:P}}))},500),C=()=>{b.value&&s.go(-1)},E=()=>{w.value&&s.go(1)},L=()=>{const P=r.value.trim();P&&(l.setSearchKeyword(P),s.push({name:"Search",query:{q:P}}))},n=()=>{h(r.value)},k=()=>{s.push({name:"NowPlaying"})},K=()=>{p.value=!p.value},W=()=>{p.value=!1,s.push({name:"Login"})},j=()=>{p.value=!1,l.showModal("settingsModal")},z=async()=>{try{l.setLoading(!0),await a.logout(),l.showSuccess("已退出登录"),s.push({name:"Home"})}catch{l.showError("退出登录失败")}finally{l.setLoading(!1)}};G(()=>o.query.q,P=>{r.value=P||""},{immediate:!0}),G(()=>l.searchKeyword,P=>{r.value=P});const q=P=>{const S=document.querySelector(".user-menu"),R=document.querySelector(".user-avatar");p.value&&S&&!S.contains(P.target)&&R&&!R.contains(P.target)&&(p.value=!1)};return he(()=>{document.addEventListener("click",q)}),ke(()=>{document.removeEventListener("click",q)}),(P,S)=>{const R=Se("router-link");return d(),g("nav",We,[t("div",je,[t("button",{class:"nav-button",onClick:C,disabled:!b.value},[...S[2]||(S[2]=[t("i",{class:"fas fa-arrow-left"},null,-1)])],8,ze),t("button",{class:"nav-button",onClick:E,disabled:!w.value},[...S[3]||(S[3]=[t("i",{class:"fas fa-arrow-right"},null,-1)])],8,Je)]),t("div",Ge,[H(R,{to:"/",class:V(["nav-link",{active:P.$route.name==="Home"}])},{default:te(()=>[...S[4]||(S[4]=[D(" 首页 ",-1)])]),_:1},8,["class"]),H(R,{to:"/discover",class:V(["nav-link",{active:P.$route.name==="Discover"}])},{default:te(()=>[...S[5]||(S[5]=[D(" 发现 ",-1)])]),_:1},8,["class"]),I.value?(d(),g("a",{key:0,class:"nav-link",onClick:k}," 正在播放 ")):x("",!0)]),t("div",Xe,[t("div",Ye,[S[6]||(S[6]=t("i",{class:"fas fa-search search-icon"},null,-1)),F(t("input",{"onUpdate:modelValue":S[0]||(S[0]=f=>r.value=f),onKeyup:Le(L,["enter"]),onInput:n,class:"search-input",placeholder:"搜索音乐、歌手、专辑"},null,544),[[ne,r.value]])]),t("div",Ze,[_(a).isLoggedIn?(d(),g("div",es,[t("span",ss,v(_(a).nickname||"用户"),1),S[7]||(S[7]=t("div",{class:"user-status"},[t("span",{class:"status-indicator online"}),t("span",{class:"status-text"},"在线")],-1))])):x("",!0),t("div",{class:"user-avatar",onClick:K},[_(a).avatarUrl?(d(),g("img",{key:0,src:_(a).avatarUrl,alt:_(a).nickname,class:"avatar-image"},null,8,ts)):(d(),g("i",os))]),p.value?(d(),g("div",{key:1,class:"user-menu",onClick:S[1]||(S[1]=le(()=>{},["stop"]))},[t("div",as,[t("div",ls,[_(a).avatarUrl?(d(),g("img",{key:0,src:_(a).avatarUrl,alt:_(a).nickname},null,8,is)):(d(),g("i",rs))]),t("div",ns,[t("div",cs,v(_(a).nickname||"未登录"),1),t("div",us,[t("span",{class:V(["status-indicator",{online:_(a).isLoggedIn}])},null,2),t("span",null,v(_(a).isLoggedIn?"在线":"未登录"),1)])])]),t("div",ds,[t("button",{class:"menu-item",onClick:j},[...S[8]||(S[8]=[t("i",{class:"fas fa-cog"},null,-1),D(" 设置 ",-1)])]),_(a).isLoggedIn?(d(),g("button",{key:1,class:"menu-item",onClick:z},[...S[10]||(S[10]=[t("i",{class:"fas fa-sign-out-alt"},null,-1),D(" 退出登录 ",-1)])])):(d(),g("button",{key:0,class:"menu-item",onClick:W},[...S[9]||(S[9]=[t("i",{class:"fas fa-sign-in-alt"},null,-1),D(" 登录 / 注册 ",-1)])]))])])):x("",!0),_(a).isLoggedIn?(d(),g("button",{key:2,class:"logout-button",onClick:z,title:"退出登录"},[...S[11]||(S[11]=[t("i",{class:"fas fa-sign-out-alt"},null,-1)])])):x("",!0)])])])}}},gs=Z(hs,[["__scopeId","data-v-eb2b543d"]]),ms={class:"player"},fs=["src","alt"],ps={key:1,class:"cover-placeholder"},ys={class:"song-name"},vs={key:0,class:"song-artist"},ks={class:"artist-name"},Ss={key:0},_s={class:"album-name"},ws={class:"player-controls"},Is=["title"],bs={key:0,class:"fas fa-redo-alt"},Ls={key:1,class:"fas fa-redo-alt"},Cs={key:2,class:"fas fa-random"},Ps=["disabled"],$s={key:0,class:"fas fa-play"},Ms={key:1,class:"fas fa-pause"},xs=["disabled"],Us={class:"volume-control"},Ts={key:0,class:"fas fa-volume-up"},As={key:1,class:"fas fa-volume-down"},Ds={key:2,class:"fas fa-volume-mute"},Es={class:"time-display"},Vs={__name:"Player",setup(e){const s=ee(),o=Y(),a=X(),i=A(null),l=A(null),r=M(()=>s.currentSong),p=M(()=>s.isPlaying),I=M(()=>s.progress),b=M(()=>s.volume),w=M(()=>s.playMode),h=M(()=>s.playModeText),C=M(()=>s.hasPrevious),E=M(()=>s.hasNext),L=M(()=>s.formattedCurrentTime),n=M(()=>s.formattedDuration),k=M(()=>r.value?o.isLiked(r.value.id):!1),K=f=>f!=null&&f.artists?f.artists.map(c=>c.name).join(", "):"",W=f=>{if(!i.value)return;const c=i.value.getBoundingClientRect(),u=(f.clientX-c.left)/c.width*100;s.setProgress(u)},j=f=>{if(!l.value)return;const c=l.value.getBoundingClientRect(),u=(f.clientX-c.left)/c.width;s.setVolume(Math.max(0,Math.min(1,u)))},z=()=>{s.setVolume(b.value>0?0:.8)},q=()=>{s.togglePlayMode(),a.showSuccess(`切换到${h.value}`)},P=()=>{a.showModal("playingModal")},S=async()=>{if(!(!r.value||!o.isLoggedIn))try{const f=k.value;if(await B.likeSong(r.value.id,!f),f){const c=o.likeList.indexOf(r.value.id);c>-1&&o.likeList.splice(c,1)}else o.likeList.push(r.value.id);a.showSuccess(f?"已取消喜欢":"已添加到我喜欢的音乐")}catch{a.showError("操作失败")}},R=async()=>{if(r.value)try{a.showSuccess("下载功能开发中...")}catch{a.showError("下载失败")}};return(f,c)=>{var u,m,O,$,U;return d(),g("div",ms,[t("div",{class:"progress-bar",onClick:W,ref_key:"progressBar",ref:i},[t("div",{class:"progress-fill",style:ae({width:I.value+"%"})},null,4)],512),t("div",{class:"player-cover",onClick:P},[(m=(u=r.value)==null?void 0:u.album)!=null&&m.picUrl?(d(),g("img",{key:0,src:_(N).getImageUrl(r.value.album.picUrl,100),alt:r.value.name,class:"cover-image"},null,8,fs)):(d(),g("div",ps,[...c[3]||(c[3]=[t("i",{class:"fas fa-music"},null,-1)])]))]),t("div",{class:"player-info",onClick:P},[t("div",ys,v(((O=r.value)==null?void 0:O.name)||"未在播放"),1),r.value?(d(),g("div",vs,[t("span",ks,v(K(r.value)),1),($=r.value.album)!=null&&$.name?(d(),g("span",Ss," - ")):x("",!0),t("span",_s,v((U=r.value.album)==null?void 0:U.name),1)])):x("",!0)]),t("div",ws,[t("button",{class:V(["control-button loop-button",{active:w.value!==0}]),onClick:q,title:h.value},[w.value===0?(d(),g("i",bs)):w.value===1?(d(),g("i",Ls)):(d(),g("i",Cs))],10,Is),t("button",{class:"control-button",onClick:c[0]||(c[0]=(...J)=>_(s).previous&&_(s).previous(...J)),disabled:!C.value},[...c[4]||(c[4]=[t("i",{class:"fas fa-backward"},null,-1)])],8,Ps),t("button",{class:"control-button primary",onClick:c[1]||(c[1]=(...J)=>_(s).togglePlay&&_(s).togglePlay(...J))},[p.value?(d(),g("i",Ms)):(d(),g("i",$s))]),t("button",{class:"control-button",onClick:c[2]||(c[2]=(...J)=>_(s).next&&_(s).next(...J)),disabled:!E.value},[...c[5]||(c[5]=[t("i",{class:"fas fa-forward"},null,-1)])],8,xs),r.value?(d(),g("button",{key:0,class:V(["control-button",{active:k.value}]),onClick:S},[...c[6]||(c[6]=[t("i",{class:"fas fa-heart"},null,-1)])],2)):x("",!0),r.value?(d(),g("button",{key:1,class:"control-button",onClick:R,title:"下载当前歌曲"},[...c[7]||(c[7]=[t("i",{class:"fas fa-download"},null,-1)])])):x("",!0)]),t("div",Us,[t("button",{class:"volume-button",onClick:z},[b.value>.5?(d(),g("i",Ts)):b.value>0?(d(),g("i",As)):(d(),g("i",Ds))]),t("div",{class:"volume-slider",onClick:j,ref_key:"volumeSlider",ref:l},[t("div",{class:"volume-fill",style:ae({width:b.value*100+"%"})},null,4)],512)]),t("div",Es,[t("span",null,v(L.value),1),c[8]||(c[8]=t("span",null,"/",-1)),t("span",null,v(n.value),1)])])}}},qs=Z(Vs,[["__scopeId","data-v-b9bd825c"]]),Rs={class:"message-container"},Os={key:"success",class:"message message-success"},Ns={key:"error",class:"message message-error"},Qs={__name:"MessageContainer",setup(e){const s=X();return(o,a)=>(d(),g("div",Rs,[H(Ce,{name:"message",tag:"div"},{default:te(()=>[_(s).successMessage?(d(),g("div",Os,[a[0]||(a[0]=t("i",{class:"fas fa-check-circle"},null,-1)),D(" "+v(_(s).successMessage),1)])):x("",!0),_(s).errorMessage?(d(),g("div",Ns,[a[1]||(a[1]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),D(" "+v(_(s).errorMessage),1)])):x("",!0)]),_:1})]))}},Fs=Z(Qs,[["__scopeId","data-v-b9e1c7cd"]]),Hs={class:"modal-content"},Bs={key:0,class:"loading-container"},Ks={key:1,class:"error-container"},Ws={class:"error-message"},js={key:2,class:"artist-detail"},zs={class:"artist-info"},Js={class:"artist-avatar"},Gs=["src","alt"],Xs={class:"artist-meta"},Ys={key:0,class:"artist-alias"},Zs={key:1,class:"artist-desc"},et={class:"artist-stats"},st={class:"artist-actions"},tt={class:"hot-songs-section"},ot={key:0,class:"loading-songs"},at={key:1,class:"songs-list"},lt=["onDblclick"],it={class:"song-index"},rt={class:"song-cover"},nt=["src","alt"],ct={class:"song-overlay"},ut=["onClick"],dt={class:"song-info"},ht={class:"song-name"},gt={class:"song-album"},mt={class:"song-popularity"},ft={class:"popularity-bar"},pt={class:"song-actions"},yt=["onClick"],vt=["onClick"],kt=["onClick"],St=["onClick"],_t={key:2,class:"view-more"},wt={key:0,class:"all-songs-section"},It={class:"songs-list"},bt=["onDblclick"],Lt={class:"song-index"},Ct={class:"song-cover"},Pt=["src","alt"],$t={class:"song-overlay"},Mt=["onClick"],xt={class:"song-info"},Ut={class:"song-name"},Tt={class:"song-album"},At={class:"song-popularity"},Dt={class:"popularity-bar"},Et={class:"song-actions"},Vt=["onClick"],qt=["onClick"],Rt=["onClick"],Ot=["onClick"],Nt={__name:"ArtistModal",setup(e){const s=X(),o=ee(),a=Y(),i=M(()=>s.modals.artistModal),l=M(()=>s.currentArtistId),r=A(null),p=A([]),I=A(!1),b=A(!1),w=A(""),h=A(!1),C=A(!1),E=async()=>{if(l.value){I.value=!0,w.value="";try{const f=await B.getArtistDetail(l.value);if(f.code===200)r.value=f.data.artist,await L();else throw new Error(f.message||"加载歌手失败")}catch(f){console.error("加载歌手详情失败:",f),w.value=f.message||"加载失败，请稍后重试"}finally{I.value=!1}}},L=async()=>{if(l.value){b.value=!0;try{const f=await B.getArtistTopSongs(l.value);if(f.code===200)p.value=f.songs||[];else throw new Error("加载歌曲失败")}catch(f){console.error("加载热门歌曲失败:",f),s.showError("加载歌曲失败")}finally{b.value=!1}}},n=(f,c)=>{o.setPlaylist(p.value,c),o.play()},k=()=>{p.value.length>0&&(o.setPlaylist(p.value,0),o.play())},K=f=>{o.addToPlaylist(f),s.showSuccess("已添加到播放列表")},W=async f=>{if(!a.isLoggedIn){s.showError("请先登录");return}try{const c=q(f.id);await B.likeSong(f.id,!c),c?a.removeFromLikedSongs(f.id):a.addToLikedSongs(f),s.showSuccess(c?"已取消喜欢":"已添加到我喜欢的音乐")}catch{s.showError("操作失败")}},j=f=>{s.showInfo("下载功能开发中")},z=async()=>{if(!a.isLoggedIn){s.showError("请先登录");return}h.value=!h.value,s.showSuccess(h.value?"已关注歌手":"已取消关注")},q=f=>a.likedSongs.some(c=>c.id===f),P=f=>`${Math.min(f||0,100)}%`,S=()=>{s.hideModal("artistModal"),r.value=null,p.value=[],w.value="",C.value=!1},R=()=>{S()};return G(l,f=>{f&&i.value&&E()}),G(i,f=>{f&&l.value&&E()}),(f,c)=>(d(),g("div",{class:V(["modal-overlay",{active:i.value}]),onClick:R},[t("div",{class:"modal-container artist-modal",onClick:c[1]||(c[1]=le(()=>{},["stop"]))},[t("div",{class:"modal-header"},[c[2]||(c[2]=t("h2",null,"歌手详情",-1)),t("button",{class:"modal-close",onClick:S},"×")]),t("div",Hs,[I.value?(d(),g("div",Bs,[...c[3]||(c[3]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"加载中...",-1)])])):w.value?(d(),g("div",Ks,[t("div",Ws,v(w.value),1),t("button",{class:"neu-button",onClick:E},"重试")])):r.value?(d(),g("div",js,[t("div",zs,[t("div",Js,[t("img",{src:_(N).getImageUrl(r.value.img1v1Url,300),alt:r.value.name},null,8,Gs)]),t("div",Xs,[t("h1",null,v(r.value.name),1),r.value.alias&&r.value.alias.length>0?(d(),g("p",Ys,v(r.value.alias.join(", ")),1)):x("",!0),r.value.briefDesc?(d(),g("p",Zs,v(r.value.briefDesc),1)):x("",!0),t("div",et,[t("span",null,[c[4]||(c[4]=t("i",{class:"fas fa-music"},null,-1)),D(" "+v(r.value.musicSize||0)+" 首歌曲",1)]),t("span",null,[c[5]||(c[5]=t("i",{class:"fas fa-compact-disc"},null,-1)),D(" "+v(r.value.albumSize||0)+" 张专辑",1)]),t("span",null,[c[6]||(c[6]=t("i",{class:"fas fa-users"},null,-1)),D(" "+v(_(N).formatPlayCount(r.value.followed||0))+" 关注",1)])]),t("div",st,[t("button",{class:"neu-button primary",onClick:k},[...c[7]||(c[7]=[t("i",{class:"fas fa-play"},null,-1),D(" 播放热门歌曲 ",-1)])]),t("button",{class:"neu-button",onClick:z},[t("i",{class:V(["fas fa-heart",{liked:h.value}])},null,2),D(" "+v(h.value?"已关注":"关注"),1)])])])]),t("div",tt,[t("div",{class:"section-header"},[c[9]||(c[9]=t("h3",null,"热门歌曲",-1)),t("button",{class:"action-btn",onClick:k,title:"播放全部"},[...c[8]||(c[8]=[t("i",{class:"fas fa-play"},null,-1)])])]),b.value?(d(),g("div",ot,[...c[10]||(c[10]=[t("div",{class:"loading-spinner small"},null,-1),t("p",null,"加载歌曲中...",-1)])])):(d(),g("div",at,[(d(!0),g(ce,null,ue(p.value.slice(0,10),(u,m)=>{var O,$;return d(),g("div",{key:u.id,class:"song-item",onDblclick:U=>n(u,m)},[t("div",it,v(m+1),1),t("div",rt,[t("img",{src:_(N).getImageUrl((O=u.al)==null?void 0:O.picUrl,100),alt:u.name},null,8,nt),t("div",ct,[t("i",{class:"fas fa-play",onClick:U=>n(u,m)},null,8,ut)])]),t("div",dt,[t("h4",ht,v(u.name),1),t("p",gt,v(($=u.al)==null?void 0:$.name),1)]),t("div",mt,[t("div",ft,[t("div",{class:"popularity-fill",style:ae({width:P(u.pop)})},null,4)])]),t("div",pt,[t("button",{class:"action-btn",onClick:U=>n(u,m),title:"播放"},[...c[11]||(c[11]=[t("i",{class:"fas fa-play"},null,-1)])],8,yt),t("button",{class:"action-btn",onClick:U=>K(u),title:"添加到播放列表"},[...c[12]||(c[12]=[t("i",{class:"fas fa-plus"},null,-1)])],8,vt),t("button",{class:"action-btn",onClick:U=>W(u),title:"喜欢"},[t("i",{class:V(["fas fa-heart",{liked:q(u.id)}])},null,2)],8,kt),t("button",{class:"action-btn",onClick:U=>j(),title:"下载"},[...c[13]||(c[13]=[t("i",{class:"fas fa-download"},null,-1)])],8,St)])],40,lt)}),128))])),p.value.length>10?(d(),g("div",_t,[t("button",{class:"neu-button",onClick:c[0]||(c[0]=u=>C.value=!C.value)},[D(v(C.value?"收起":"查看更多")+" ",1),t("i",{class:V(C.value?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)])])):x("",!0)]),C.value&&p.value.length>10?(d(),g("div",wt,[t("div",It,[(d(!0),g(ce,null,ue(p.value.slice(10),(u,m)=>{var O,$;return d(),g("div",{key:u.id,class:"song-item",onDblclick:U=>n(u,m+10)},[t("div",Lt,v(m+11),1),t("div",Ct,[t("img",{src:_(N).getImageUrl((O=u.al)==null?void 0:O.picUrl,100),alt:u.name},null,8,Pt),t("div",$t,[t("i",{class:"fas fa-play",onClick:U=>n(u,m+10)},null,8,Mt)])]),t("div",xt,[t("h4",Ut,v(u.name),1),t("p",Tt,v(($=u.al)==null?void 0:$.name),1)]),t("div",At,[t("div",Dt,[t("div",{class:"popularity-fill",style:ae({width:P(u.pop)})},null,4)])]),t("div",Et,[t("button",{class:"action-btn",onClick:U=>n(u,m+10),title:"播放"},[...c[14]||(c[14]=[t("i",{class:"fas fa-play"},null,-1)])],8,Vt),t("button",{class:"action-btn",onClick:U=>K(u),title:"添加到播放列表"},[...c[15]||(c[15]=[t("i",{class:"fas fa-plus"},null,-1)])],8,qt),t("button",{class:"action-btn",onClick:U=>W(u),title:"喜欢"},[t("i",{class:V(["fas fa-heart",{liked:q(u.id)}])},null,2)],8,Rt),t("button",{class:"action-btn",onClick:U=>j(),title:"下载"},[...c[16]||(c[16]=[t("i",{class:"fas fa-download"},null,-1)])],8,Ot)])],40,bt)}),128))])])):x("",!0)])):x("",!0)])])],2))}},Qt=Z(Nt,[["__scopeId","data-v-6a1d4c69"]]),Ft={class:"modal-content"},Ht={key:0,class:"loading-container"},Bt={key:1,class:"error-container"},Kt={class:"error-message"},Wt={key:2,class:"playlist-detail"},jt={class:"playlist-info"},zt={class:"playlist-cover"},Jt=["src","alt"],Gt={class:"playlist-meta"},Xt={class:"creator"},Yt={key:0,class:"description"},Zt={class:"playlist-stats"},eo={class:"playlist-actions"},so={class:"songs-section"},to={key:0,class:"loading-songs"},oo={key:1,class:"songs-list"},ao=["onDblclick"],lo={class:"song-index"},io={class:"song-cover"},ro=["src","alt"],no={class:"song-overlay"},co=["onClick"],uo={class:"song-info"},ho={class:"song-name"},go={class:"song-artist"},mo={class:"song-album"},fo={class:"song-duration"},po={class:"song-actions"},yo=["onClick"],vo=["onClick"],ko=["onClick"],So=["onClick"],_o={__name:"PlaylistModal",setup(e){const s=X(),o=ee(),a=Y(),i=M(()=>s.modals.playlistModal),l=M(()=>s.currentPlaylistId),r=A(null),p=A([]),I=A(!1),b=A(!1),w=A(""),h=A(!1),C=async()=>{if(l.value){I.value=!0,w.value="";try{const u=await B.getPlaylistDetail(l.value);if(u.code===200)r.value=u.playlist,await E();else throw new Error(u.message||"加载歌单失败")}catch(u){console.error("加载歌单详情失败:",u),w.value=u.message||"加载失败，请稍后重试"}finally{I.value=!1}}},E=async()=>{if(r.value){b.value=!0;try{const u=await B.getPlaylistTracks(r.value.id);if(u.code===200)p.value=u.songs||[];else throw new Error("加载歌曲失败")}catch(u){console.error("加载歌曲失败:",u),s.showError("加载歌曲失败")}finally{b.value=!1}}},L=(u,m)=>{o.setPlaylist(p.value,m),o.play()},n=()=>{p.value.length>0&&(o.setPlaylist(p.value,0),o.play())},k=u=>{o.addToPlaylist(u),s.showSuccess("已添加到播放列表")},K=async u=>{if(!a.isLoggedIn){s.showError("请先登录");return}try{const m=q(u.id);await B.likeSong(u.id,!m),m?a.removeFromLikedSongs(u.id):a.addToLikedSongs(u),s.showSuccess(m?"已取消喜欢":"已添加到我喜欢的音乐")}catch{s.showError("操作失败")}},W=u=>{s.showInfo("下载功能开发中")},j=()=>{s.showInfo("批量下载功能开发中")},z=async()=>{if(!a.isLoggedIn){s.showError("请先登录");return}h.value=!h.value,s.showSuccess(h.value?"已收藏歌单":"已取消收藏")},q=u=>a.likedSongs.some(m=>m.id===u),P=u=>u.ar?u.ar.map(m=>m.name).join(", "):"未知艺人",S=u=>N.formatTime(u/1e3),R=u=>new Date(u).toLocaleDateString("zh-CN"),f=()=>{s.hideModal("playlistModal"),r.value=null,p.value=[],w.value=""},c=()=>{f()};return G(l,u=>{u&&i.value&&C()}),G(i,u=>{u&&l.value&&C()}),(u,m)=>{var O;return d(),g("div",{class:V(["modal-overlay",{active:i.value}]),onClick:c},[t("div",{class:"modal-container playlist-modal",onClick:m[0]||(m[0]=le(()=>{},["stop"]))},[t("div",{class:"modal-header"},[m[1]||(m[1]=t("h2",null,"歌单详情",-1)),t("button",{class:"modal-close",onClick:f},"×")]),t("div",Ft,[I.value?(d(),g("div",Ht,[...m[2]||(m[2]=[t("div",{class:"loading-spinner"},null,-1),t("p",null,"加载中...",-1)])])):w.value?(d(),g("div",Bt,[t("div",Kt,v(w.value),1),t("button",{class:"neu-button",onClick:C},"重试")])):r.value?(d(),g("div",Wt,[t("div",jt,[t("div",zt,[t("img",{src:_(N).getImageUrl(r.value.coverImgUrl,300),alt:r.value.name},null,8,Jt),t("div",{class:"play-overlay",onClick:n},[...m[3]||(m[3]=[t("i",{class:"fas fa-play"},null,-1)])])]),t("div",Gt,[t("h1",null,v(r.value.name),1),t("p",Xt,"by "+v((O=r.value.creator)==null?void 0:O.nickname),1),r.value.description?(d(),g("p",Yt,v(r.value.description),1)):x("",!0),t("div",Zt,[t("span",null,[m[4]||(m[4]=t("i",{class:"fas fa-music"},null,-1)),D(" "+v(r.value.trackCount)+" 首歌曲",1)]),t("span",null,[m[5]||(m[5]=t("i",{class:"fas fa-headphones"},null,-1)),D(" "+v(_(N).formatPlayCount(r.value.playCount)),1)]),t("span",null,[m[6]||(m[6]=t("i",{class:"fas fa-calendar"},null,-1)),D(" "+v(R(r.value.createTime)),1)])]),t("div",eo,[t("button",{class:"neu-button primary",onClick:n},[...m[7]||(m[7]=[t("i",{class:"fas fa-play"},null,-1),D(" 播放全部 ",-1)])]),t("button",{class:"neu-button",onClick:z},[t("i",{class:V(["fas fa-heart",{liked:h.value}])},null,2),D(" "+v(h.value?"已收藏":"收藏"),1)])])])]),t("div",so,[t("div",{class:"songs-header"},[m[9]||(m[9]=t("h3",null,"歌曲列表",-1)),t("div",{class:"songs-actions"},[t("button",{class:"action-btn",onClick:j,title:"下载全部"},[...m[8]||(m[8]=[t("i",{class:"fas fa-download"},null,-1)])])])]),b.value?(d(),g("div",to,[...m[10]||(m[10]=[t("div",{class:"loading-spinner small"},null,-1),t("p",null,"加载歌曲中...",-1)])])):(d(),g("div",oo,[(d(!0),g(ce,null,ue(p.value,($,U)=>{var J,ge;return d(),g("div",{key:$.id,class:"song-item",onDblclick:se=>L($,U)},[t("div",lo,v(U+1),1),t("div",io,[t("img",{src:_(N).getImageUrl((J=$.al)==null?void 0:J.picUrl,100),alt:$.name},null,8,ro),t("div",no,[t("i",{class:"fas fa-play",onClick:se=>L($,U)},null,8,co)])]),t("div",uo,[t("h4",ho,v($.name),1),t("p",go,v(P($)),1),t("p",mo,v((ge=$.al)==null?void 0:ge.name),1)]),t("div",fo,v(S($.dt)),1),t("div",po,[t("button",{class:"action-btn",onClick:se=>L($,U),title:"播放"},[...m[11]||(m[11]=[t("i",{class:"fas fa-play"},null,-1)])],8,yo),t("button",{class:"action-btn",onClick:se=>k($),title:"添加到播放列表"},[...m[12]||(m[12]=[t("i",{class:"fas fa-plus"},null,-1)])],8,vo),t("button",{class:"action-btn",onClick:se=>K($),title:"喜欢"},[t("i",{class:V(["fas fa-heart",{liked:q($.id)}])},null,2)],8,ko),t("button",{class:"action-btn",onClick:se=>W(),title:"下载"},[...m[13]||(m[13]=[t("i",{class:"fas fa-download"},null,-1)])],8,So)])],40,ao)}),128))]))])])):x("",!0)])])],2)}}},wo=Z(_o,[["__scopeId","data-v-3b37fcf1"]]),Io={class:"modal-content"},bo={class:"settings-section"},Lo={class:"setting-item api-url-item"},Co={class:"api-url-input"},Po={class:"settings-section"},$o={class:"setting-item"},Mo={class:"setting-item"},xo={class:"setting-item"},Uo={class:"settings-section"},To={class:"setting-item"},Ao={class:"setting-item"},Do={class:"settings-section"},Eo={class:"setting-item"},Vo={class:"setting-item"},qo={class:"download-path"},Ro={__name:"SettingsModal",setup(e){const s=X(),o=M(()=>s.modals.settingsModal),a=A(s.apiUrl),i={audioQuality:"320000",autoPlay:!0,crossfade:!1,theme:"auto",compactMode:!1,showLyrics:!0,downloadPath:"./downloads"},l=Pe({...i}),r=()=>{try{const L=localStorage.getItem("neumusic-settings");if(L){const n=JSON.parse(L);Object.assign(l,{...i,...n})}}catch(L){console.error("加载设置失败:",L)}},p=(L,n)=>{l[L]=n,I()},I=()=>{try{localStorage.setItem("neumusic-settings",JSON.stringify(l)),s.showSuccess("设置已保存")}catch(L){console.error("保存设置失败:",L),s.showError("保存设置失败")}},b=()=>{Object.assign(l,i),I(),s.showSuccess("已恢复默认设置")},w=()=>{s.showInfo("文件选择功能需要在桌面应用中实现")},h=()=>{try{let L=a.value.trim();if(!L){s.showError("请输入有效的 API 地址");return}L.endsWith("/")||(L+="/"),s.setApiUrl(L),s.showSuccess("API 地址已应用")}catch{s.showError("应用失败，请检查地址")}},C=()=>{s.hideModal("settingsModal")},E=()=>{C()};return he(()=>{r()}),(L,n)=>(d(),g("div",{class:V(["modal-overlay",{active:o.value}]),onClick:E},[t("div",{class:"modal-container settings-modal",onClick:n[14]||(n[14]=le(()=>{},["stop"]))},[t("div",{class:"modal-header"},[n[15]||(n[15]=t("h2",null,"设置",-1)),t("button",{class:"modal-close",onClick:C},"×")]),t("div",Io,[t("div",bo,[n[17]||(n[17]=t("h3",null,"接口设置",-1)),t("div",Lo,[n[16]||(n[16]=t("label",null,"网易云 API 地址",-1)),t("div",Co,[F(t("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=k=>a.value=k),placeholder:"例如 http://localhost:3000/"},null,512),[[ne,a.value]]),t("button",{class:"neu-button",onClick:h},"应用")])])]),t("div",Po,[n[22]||(n[22]=t("h3",null,"播放设置",-1)),t("div",$o,[n[19]||(n[19]=t("label",null,"音质偏好",-1)),F(t("select",{"onUpdate:modelValue":n[1]||(n[1]=k=>l.audioQuality=k),onChange:n[2]||(n[2]=k=>p("audioQuality",k.target.value))},[...n[18]||(n[18]=[t("option",{value:"128000"},"标准品质 128kbps",-1),t("option",{value:"192000"},"较高品质 192kbps",-1),t("option",{value:"320000"},"极高品质 320kbps",-1),t("option",{value:"999000"},"无损品质",-1)])],544),[[me,l.audioQuality]])]),t("div",Mo,[n[20]||(n[20]=t("label",null,"自动播放",-1)),F(t("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=k=>l.autoPlay=k),onChange:n[4]||(n[4]=k=>p("autoPlay",k.target.checked))},null,544),[[oe,l.autoPlay]])]),t("div",xo,[n[21]||(n[21]=t("label",null,"淡入淡出",-1)),F(t("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=k=>l.crossfade=k),onChange:n[6]||(n[6]=k=>p("crossfade",k.target.checked))},null,544),[[oe,l.crossfade]])])]),t("div",Uo,[n[26]||(n[26]=t("h3",null,"界面设置",-1)),t("div",To,[n[24]||(n[24]=t("label",null,"主题色彩",-1)),F(t("select",{"onUpdate:modelValue":n[7]||(n[7]=k=>l.theme=k),onChange:n[8]||(n[8]=k=>p("theme",k.target.value))},[...n[23]||(n[23]=[t("option",{value:"auto"},"跟随系统",-1),t("option",{value:"light"},"浅色模式",-1),t("option",{value:"dark"},"深色模式",-1)])],544),[[me,l.theme]])]),t("div",Ao,[n[25]||(n[25]=t("label",null,"紧凑模式",-1)),F(t("input",{type:"checkbox","onUpdate:modelValue":n[9]||(n[9]=k=>l.compactMode=k),onChange:n[10]||(n[10]=k=>p("compactMode",k.target.checked))},null,544),[[oe,l.compactMode]])])]),t("div",Do,[n[29]||(n[29]=t("h3",null,"其他设置",-1)),t("div",Eo,[n[27]||(n[27]=t("label",null,"显示歌词",-1)),F(t("input",{type:"checkbox","onUpdate:modelValue":n[11]||(n[11]=k=>l.showLyrics=k),onChange:n[12]||(n[12]=k=>p("showLyrics",k.target.checked))},null,544),[[oe,l.showLyrics]])]),t("div",Vo,[n[28]||(n[28]=t("label",null,"下载位置",-1)),t("div",qo,[F(t("input",{type:"text","onUpdate:modelValue":n[13]||(n[13]=k=>l.downloadPath=k),readonly:""},null,512),[[ne,l.downloadPath]]),t("button",{class:"neu-button",onClick:w},"选择")])])]),t("div",{class:"settings-actions"},[t("button",{class:"neu-button",onClick:b},"恢复默认"),t("button",{class:"neu-button primary",onClick:I},"保存设置")])])])],2))}},Oo=Z(Ro,[["__scopeId","data-v-9e020048"]]),No={class:"app"},Qo={class:"app-main"},Fo={key:2,class:"global-loading"},Ho={__name:"App",setup(e){const s=ve(),o=Y(),a=ee(),i=X(),l=M(()=>s.name==="Login"),r=M(()=>a.currentSong),p=M(()=>i.loading);G(s,h=>{i.setCurrentPage(h.name)},{immediate:!0}),G(()=>i.theme,h=>{document.documentElement.setAttribute("data-theme",h)},{immediate:!0});const I=()=>{document.visibilityState==="hidden"||o.isLoggedIn&&o.verifyLoginStatus()},b=h=>{if(!(h.target.tagName==="INPUT"||h.target.tagName==="TEXTAREA"))switch(h.code){case"Space":h.preventDefault(),a.togglePlay();break;case"ArrowLeft":h.ctrlKey&&(h.preventDefault(),a.previous());break;case"ArrowRight":h.ctrlKey&&(h.preventDefault(),a.next());break;case"ArrowUp":if(h.ctrlKey){h.preventDefault();const C=Math.min(1,a.volume+.1);a.setVolume(C)}break;case"ArrowDown":if(h.ctrlKey){h.preventDefault();const C=Math.max(0,a.volume-.1);a.setVolume(C)}break}};return he(()=>{i.initializeApp(),o.restoreLoginState(),document.addEventListener("visibilitychange",I),document.addEventListener("keydown",b),document.addEventListener("dragover",h=>h.preventDefault()),document.addEventListener("drop",h=>h.preventDefault()),document.documentElement.setAttribute("data-theme",i.theme)}),ke(()=>{document.removeEventListener("visibilitychange",I),document.removeEventListener("keydown",b)}),(h,C)=>{const E=Se("router-view");return d(),g("div",No,[l.value?x("",!0):(d(),re(gs,{key:0,class:"app-nav"})),t("main",Qo,[H(E,null,{default:te(({Component:L})=>[H($e,{name:"page",mode:"out-in"},{default:te(()=>[(d(),re(Me(L)))]),_:2},1024)]),_:1})]),!l.value&&r.value?(d(),re(qs,{key:1,class:"app-player"})):x("",!0),H(Fs),H(Qt),H(wo),H(Oo),p.value?(d(),g("div",Fo,[...C[0]||(C[0]=[t("div",{class:"loading-spinner"},null,-1)])])):x("",!0)])}}},Bo=Z(Ho,[["__scopeId","data-v-1aa1ef5a"]]),ie=xe(Bo),Ko=Ue();ie.use(Ko);ie.use(_e);ie.config.errorHandler=(e,s,o)=>{console.error("Vue 错误:",e),console.error("错误信息:",o)};ie.mount("#app");const Wo=async()=>{const{useUserStore:e,usePlayerStore:s,useAppStore:o}=await Q(async()=>{const{useUserStore:a,usePlayerStore:i,useAppStore:l}=await Promise.resolve().then(()=>qe);return{useUserStore:a,usePlayerStore:i,useAppStore:l}},void 0);try{o().initializeApp(),await e().restoreLoginState();const l=s();l.initAudio(),l.restoreFromLocalStorage(),console.log("应用初始化完成")}catch(a){console.error("应用初始化失败:",a)}};document.addEventListener("DOMContentLoaded",Wo);export{Z as _,ee as a,X as b,N as c,B as m,Y as u};
