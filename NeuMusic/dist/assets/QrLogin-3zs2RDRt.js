import{r as t,c as M,o as L,p as q,a as u,b as s,d as N,n as m,e as v,q as V,l as h,v as B,z as I,t as k,s as Q,x as U,y as D,k as E,h as r}from"./vendor-DY0UzM5c.js";import{_ as P,u as R}from"./index-h1JUByrL.js";import{C as T}from"./utils-DOv6pLCg.js";const $={class:"qr-login-page"},z={class:"qr-login-container"},G={key:0,class:"loading-state"},O={key:1,class:"login-form"},W={class:"login-method-tabs"},J={class:"input-group"},j=["placeholder","disabled"],A={class:"input-group"},F=["type","disabled"],H=["disabled"],K=["disabled"],X={key:0,class:"fas fa-spinner fa-spin"},Y={key:1,class:"fas fa-sign-in-alt"},Z={key:2,class:"success-state"},ee={key:3,class:"error-message"},se={class:"back-link"},oe={__name:"QrLogin",setup(le){const C=E(),w=q(),p=R(),l=t("phone"),d=t(""),f=t(""),g=t(!1),a=t(!1),c=t(""),y=t(!1),S=t(!1),_=M(()=>d.value.trim()&&f.value.trim()),x=async()=>{if(_.value){a.value=!0,c.value="";try{const n=l.value==="phone",e=T.MD5(f.value).toString();let i;if(n?i=await p.loginByPhone(d.value,e):i=await p.loginByEmail(d.value,e),i.success){y.value=!0;const o=C.query.key;o&&await p.handleInternalQrLogin(o,{account:d.value,loginMethod:l.value}),setTimeout(()=>{const b=window.opener;b?(b.postMessage({type:"QR_LOGIN_SUCCESS",data:i},window.location.origin),window.close()):w.push("/")},2e3)}else c.value=i.message}catch(n){console.error("登录失败:",n),c.value="登录失败，请重试"}finally{a.value=!1}}};return L(()=>{p.isLoggedIn&&(y.value=!0,setTimeout(()=>{const n=window.opener;n?(n.postMessage({type:"QR_LOGIN_SUCCESS",data:{success:!0,message:"已登录"}},window.location.origin),window.close()):w.push("/")},1e3))}),(n,e)=>{const i=D("router-link");return r(),u("div",$,[s("div",z,[e[12]||(e[12]=s("div",{class:"qr-login-header"},[s("h1",null,"扫码登录"),s("p",null,"请在此页面完成登录以继续使用")],-1)),S.value?(r(),u("div",G,[...e[5]||(e[5]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"正在处理登录请求...",-1)])])):y.value?(r(),u("div",Z,[...e[9]||(e[9]=[s("div",{class:"success-icon"},[s("i",{class:"fas fa-check-circle"})],-1),s("h2",null,"登录成功！",-1),s("p",null,"正在跳转到音乐应用...",-1)])])):(r(),u("div",O,[s("div",W,[s("button",{class:m(["method-tab",{active:l.value==="phone"}]),onClick:e[0]||(e[0]=o=>l.value="phone")},[...e[6]||(e[6]=[s("i",{class:"fas fa-mobile-alt"},null,-1),v(" 手机号 ",-1)])],2),s("button",{class:m(["method-tab",{active:l.value==="email"}]),onClick:e[1]||(e[1]=o=>l.value="email")},[...e[7]||(e[7]=[s("i",{class:"fas fa-envelope"},null,-1),v(" 邮箱 ",-1)])],2)]),s("form",{onSubmit:V(x,["prevent"]),class:"login-form-content"},[s("div",J,[s("i",{class:m(l.value==="phone"?"fas fa-mobile-alt":"fas fa-envelope")},null,2),h(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o),placeholder:l.value==="phone"?"请输入手机号":"请输入邮箱",type:"text",disabled:a.value,required:""},null,8,j),[[B,d.value]])]),s("div",A,[e[8]||(e[8]=s("i",{class:"fas fa-lock"},null,-1)),h(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>f.value=o),placeholder:"请输入密码",type:g.value?"text":"password",disabled:a.value,required:""},null,8,F),[[I,f.value]]),s("button",{type:"button",class:"password-toggle",onClick:e[4]||(e[4]=o=>g.value=!g.value),disabled:a.value},[s("i",{class:m(g.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,H)]),s("button",{type:"submit",class:"login-button",disabled:a.value||!_.value},[a.value?(r(),u("i",X)):(r(),u("i",Y)),v(" "+k(a.value?"登录中...":"确认登录"),1)],8,K)],32)])),c.value?(r(),u("div",ee,[e[10]||(e[10]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),v(" "+k(c.value),1)])):N("",!0),s("div",se,[Q(i,{to:"/login"},{default:U(()=>[...e[11]||(e[11]=[s("i",{class:"fas fa-arrow-left"},null,-1),v(" 返回登录页面 ",-1)])]),_:1})])])])}}},ie=P(oe,[["__scopeId","data-v-f9d6c469"]]);export{ie as default};
